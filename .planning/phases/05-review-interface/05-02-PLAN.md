---
phase: 05-review-interface
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/components/CheckResults/IssueCard.tsx
  - frontend/src/components/CheckResults/CategorySection.tsx
autonomous: true

must_haves:
  truths:
    - "Each issue displays a checkbox for selection"
    - "User can type reviewer notes for any issue"
    - "Selection checkbox toggles when clicked"
    - "Notes textarea persists value while typing"
  artifacts:
    - path: "frontend/src/components/CheckResults/IssueCard.tsx"
      provides: "Issue card with checkbox and notes textarea"
      contains: "input type=\"checkbox\""
    - path: "frontend/src/components/CheckResults/CategorySection.tsx"
      provides: "Category section passing selection/notes handlers to IssueCard"
      contains: "onToggleSelect"
  key_links:
    - from: "IssueCard.tsx"
      to: "review types"
      via: "checkbox checked prop and onChange handler"
      pattern: "checked.*isSelected"
    - from: "CategorySection.tsx"
      to: "IssueCard.tsx"
      via: "passes review props to each IssueCard"
      pattern: "IssueCard.*issueId.*isSelected.*note"
---

<objective>
Enhance IssueCard with selection checkbox and notes textarea, and update CategorySection to pass review-related props to each issue card.

Purpose: REVW-01 (checkboxes for selection) and REVW-03 (reviewer notes) require IssueCard modifications. CategorySection must pass the review state handlers.

Output: Updated IssueCard and CategorySection components with review functionality.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-review-interface/05-RESEARCH.md
@.planning/phases/05-review-interface/05-01-SUMMARY.md
@frontend/src/components/CheckResults/IssueCard.tsx
@frontend/src/components/CheckResults/CategorySection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add selection and notes to IssueCard</name>
  <files>frontend/src/components/CheckResults/IssueCard.tsx</files>
  <action>
Extend IssueCard component with selection and notes functionality:

1. Update IssueCardProps interface to add optional review props:
   ```typescript
   interface IssueCardProps {
     issue: CheckIssue;
     // New optional props for review mode
     issueId?: string;
     isSelected?: boolean;
     note?: string;
     onToggleSelect?: () => void;
     onNoteChange?: (note: string) => void;
   }
   ```

2. Add checkbox to the issue card layout:
   - Place checkbox BEFORE the details/summary element
   - Use div.issue-card__selection as wrapper
   - Input type="checkbox" with:
     * id={`select-${issueId}`}
     * checked={isSelected}
     * onChange={onToggleSelect}
     * className="issue-card__checkbox"
   - Only render if issueId and onToggleSelect are provided

3. Add notes textarea inside the issue-card__details section:
   - Add after the existing content (comparison, fix, reasoning)
   - Wrap in div.issue-card__notes-section
   - Label: "Reviewer Notes:"
   - textarea with:
     * id={`notes-${issueId}`}
     * className="issue-card__notes"
     * placeholder="Add reviewer notes..."
     * value={note || ''}
     * onChange={(e) => onNoteChange?.(e.target.value)}
     * rows={2}
   - Only render if onNoteChange is provided

4. Update the root element structure:
   - Wrap checkbox + details in a container div.issue-card
   - Move severity/confidence classes to this wrapper
   - Add issue-card--reviewable class when in review mode

Keep all existing functionality intact - these are additive changes.
  </action>
  <verify>Component compiles and works without review props (backward compatible): `cd frontend && npx tsc --noEmit`</verify>
  <done>IssueCard displays checkbox and notes textarea when review props are provided, and works normally without them</done>
</task>

<task type="auto">
  <name>Task 2: Update CategorySection to pass review props</name>
  <files>frontend/src/components/CheckResults/CategorySection.tsx</files>
  <action>
Update CategorySection to support review mode:

1. Import getIssueId from hooks/useReviewState:
   ```typescript
   import { getIssueId } from '../../hooks/useReviewState';
   ```

2. Extend CategorySectionProps interface:
   ```typescript
   interface CategorySectionProps {
     category: CategoryResult;
     // New optional props for review mode
     selectedIssues?: Set<string>;
     notes?: Record<string, string>;
     onToggleSelect?: (issueId: string) => void;
     onNoteChange?: (issueId: string, note: string) => void;
   }
   ```

3. Update the IssueCard rendering in the map:
   - Calculate issueId using getIssueId(issue, category.category_id, index)
   - Pass review props to IssueCard:
     * issueId={issueId}
     * isSelected={selectedIssues?.has(issueId)}
     * note={notes?.[issueId]}
     * onToggleSelect={() => onToggleSelect?.(issueId)}
     * onNoteChange={(note) => onNoteChange?.(issueId, note)}

4. Update the key prop to use issueId instead of rule_id-index:
   ```typescript
   <IssueCard key={issueId} ... />
   ```

Maintain backward compatibility - component works without review props.
  </action>
  <verify>Component renders and TypeScript compiles: `cd frontend && npx tsc --noEmit`</verify>
  <done>CategorySection passes selection and notes handlers to each IssueCard</done>
</task>

</tasks>

<verification>
1. IssueCard shows checkbox when review props provided
2. IssueCard shows notes textarea when onNoteChange provided
3. CategorySection generates unique issueId for each issue
4. TypeScript compilation passes
5. Components work without review props (backward compatible)
</verification>

<success_criteria>
- IssueCard has checkbox input with proper onChange handler
- IssueCard has notes textarea with controlled value
- CategorySection imports and uses getIssueId helper
- CategorySection passes all review props to IssueCard
- Both components remain backward compatible
- Satisfies REVW-01 (checkboxes) and REVW-03 (notes)
</success_criteria>

<output>
After completion, create `.planning/phases/05-review-interface/05-02-SUMMARY.md`
</output>
