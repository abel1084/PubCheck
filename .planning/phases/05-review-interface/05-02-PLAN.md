---
phase: 05-review-interface
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/CheckResults/IssueCard.tsx
  - frontend/src/components/CheckResults/CategorySection.tsx
autonomous: true

must_haves:
  truths:
    - "Issue cards have selection checkboxes that toggle selection state"
    - "Issue cards have notes textarea with ~200 char limit"
    - "Category sections have select/deselect all buttons for bulk selection"
  artifacts:
    - path: "frontend/src/components/CheckResults/IssueCard.tsx"
      provides: "Enhanced IssueCard with checkbox and notes"
      exports: ["IssueCard"]
    - path: "frontend/src/components/CheckResults/CategorySection.tsx"
      provides: "Enhanced CategorySection with bulk selection"
      exports: ["CategorySection"]
  key_links:
    - from: "frontend/src/components/CheckResults/IssueCard.tsx"
      to: "checkbox onChange"
      via: "onToggleSelect callback"
      pattern: "onChange.*onToggleSelect"
    - from: "frontend/src/components/CheckResults/IssueCard.tsx"
      to: "textarea onChange"
      via: "onNoteChange callback"
      pattern: "onChange.*onNoteChange"
    - from: "frontend/src/components/CheckResults/CategorySection.tsx"
      to: "IssueCard"
      via: "component composition"
      pattern: "<IssueCard"
---

<objective>
Enhance IssueCard with selection checkbox and reviewer notes textarea. Enhance CategorySection with per-category bulk selection controls.

Purpose: Enable individual issue selection and notes at the card level, with category-level bulk actions.
Output: Modified components ready to receive review state props from parent.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/LEARNINGS.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-review-interface/05-CONTEXT.md
@.planning/phases/05-review-interface/05-RESEARCH.md
@frontend/src/components/CheckResults/IssueCard.tsx
@frontend/src/components/CheckResults/CategorySection.tsx
@frontend/src/types/checks.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance IssueCard with selection and notes</name>
  <files>frontend/src/components/CheckResults/IssueCard.tsx</files>
  <action>
Extend IssueCard to support review mode with optional props (backward compatible):

Update interface:
```typescript
interface IssueCardProps {
  issue: CheckIssue;
  // Review mode props (all optional for backward compatibility)
  issueId?: string;
  isSelected?: boolean;
  note?: string;
  onToggleSelect?: () => void;
  onNoteChange?: (note: string) => void;
}
```

Implementation:
1. **Determine review mode**: `const isReviewMode = onToggleSelect !== undefined;`

2. **Add checkbox before severity icon** (only in review mode):
   ```tsx
   {isReviewMode && (
     <div className="issue-card__selection" onClick={(e) => e.stopPropagation()}>
       <input
         type="checkbox"
         id={`select-${issueId}`}
         checked={isSelected}
         onChange={onToggleSelect}
         className="issue-card__checkbox"
       />
     </div>
   )}
   ```
   Note: stopPropagation prevents details toggle when clicking checkbox

3. **Add notes textarea in details section** (only in review mode):
   ```tsx
   {isReviewMode && (
     <div className="issue-card__notes-section">
       <label htmlFor={`notes-${issueId}`} className="issue-card__notes-label">
         Reviewer Notes:
       </label>
       <textarea
         id={`notes-${issueId}`}
         className="issue-card__notes"
         placeholder="Add notes for report..."
         value={note || ''}
         onChange={(e) => onNoteChange?.(e.target.value)}
         maxLength={200}
         rows={2}
       />
       <span className="issue-card__notes-count">
         {(note || '').length}/200
       </span>
     </div>
   )}
   ```

4. **Add visual indicator when selected**: Add `issue-card--selected` class when isSelected

5. **Keep existing IssueCard behavior** when review props not provided (backward compatible)

CSS classes added (styling in plan 03):
- `issue-card__selection`
- `issue-card__checkbox`
- `issue-card__notes-section`
- `issue-card__notes-label`
- `issue-card__notes`
- `issue-card__notes-count`
- `issue-card--selected`
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`</verify>
  <done>IssueCard renders checkbox and notes when review props provided, unchanged when not</done>
</task>

<task type="auto">
  <name>Task 2: Enhance CategorySection with bulk selection</name>
  <files>frontend/src/components/CheckResults/CategorySection.tsx</files>
  <action>
Extend CategorySection to support review mode with per-category selection controls:

Update interface:
```typescript
interface CategorySectionProps {
  category: CategoryResult;
  // Review mode props (all optional for backward compatibility)
  issueIds?: string[];  // IDs of issues in this category
  selectedIds?: Set<string>;  // Currently selected issue IDs
  notes?: Record<string, string>;  // Issue ID -> note text
  onToggleSelect?: (issueId: string) => void;
  onSelectCategory?: () => void;  // Select all in this category
  onDeselectCategory?: () => void;  // Deselect all in this category
  onNoteChange?: (issueId: string, note: string) => void;
}
```

Implementation:
1. **Determine review mode**: `const isReviewMode = onToggleSelect !== undefined;`

2. **Calculate category selection state** (for indeterminate checkbox):
   ```typescript
   const selectedInCategory = issueIds?.filter(id => selectedIds?.has(id)).length ?? 0;
   const totalInCategory = issueIds?.length ?? 0;
   const isAllSelected = selectedInCategory === totalInCategory && totalInCategory > 0;
   const isPartiallySelected = selectedInCategory > 0 && selectedInCategory < totalInCategory;
   ```

3. **Add category header checkbox with select/deselect** (only in review mode):
   After the category name, add:
   ```tsx
   {isReviewMode && hasIssues && (
     <div className="category-section__selection" onClick={(e) => e.stopPropagation()}>
       <input
         type="checkbox"
         checked={isAllSelected}
         ref={(el) => { if (el) el.indeterminate = isPartiallySelected; }}
         onChange={() => isAllSelected ? onDeselectCategory?.() : onSelectCategory?.()}
         className="category-section__checkbox"
         title={isAllSelected ? 'Deselect all in category' : 'Select all in category'}
       />
       <span className="category-section__selection-count">
         {selectedInCategory}/{totalInCategory}
       </span>
     </div>
   )}
   ```

4. **Pass review props to IssueCard**:
   ```tsx
   {sortedIssues.map((issue, index) => {
     const issueId = issueIds?.[index];
     return (
       <IssueCard
         key={`${issue.rule_id}-${index}`}
         issue={issue}
         issueId={issueId}
         isSelected={issueId ? selectedIds?.has(issueId) : false}
         note={issueId ? notes?.[issueId] : undefined}
         onToggleSelect={issueId && onToggleSelect ? () => onToggleSelect(issueId) : undefined}
         onNoteChange={issueId && onNoteChange ? (note) => onNoteChange(issueId, note) : undefined}
       />
     );
   })}
   ```

5. **Keep existing CategorySection behavior** when review props not provided

CSS classes added (styling in plan 03):
- `category-section__selection`
- `category-section__checkbox`
- `category-section__selection-count`
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`</verify>
  <done>CategorySection passes review props to IssueCards and shows bulk selection controls</done>
</task>

</tasks>

<verification>
1. Both components compile without TypeScript errors
2. IssueCard works without review props (backward compatible)
3. CategorySection works without review props (backward compatible)
4. Checkbox events don't bubble to details toggle (stopPropagation)
5. Category checkbox shows indeterminate state when partially selected
6. Notes textarea has maxLength={200} per CONTEXT.md
</verification>

<success_criteria>
1. IssueCard shows checkbox and notes when review mode enabled
2. CategorySection shows bulk selection controls when review mode enabled
3. Existing behavior preserved when review props not provided
4. Event handling prevents click conflicts with details/summary
</success_criteria>

<output>
After completion, create `.planning/phases/05-review-interface/05-02-SUMMARY.md`
</output>
