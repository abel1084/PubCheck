---
phase: 05-review-interface
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - frontend/src/components/CheckResults/CheckResults.tsx
  - frontend/src/components/CheckResults/CheckResults.css
autonomous: true

must_haves:
  truths:
    - "CheckResults integrates useReviewState and passes props to children"
    - "Summary bar appears fixed at bottom with counts and filters"
    - "Filtering by severity hides/shows issues dynamically"
    - "Category filter dropdown filters to specific category"
  artifacts:
    - path: "frontend/src/components/CheckResults/CheckResults.tsx"
      provides: "Integrated review interface with state management"
      exports: ["CheckResults"]
    - path: "frontend/src/components/CheckResults/CheckResults.css"
      provides: "Styling for review features"
      contains: ".review-summary-bar"
  key_links:
    - from: "frontend/src/components/CheckResults/CheckResults.tsx"
      to: "frontend/src/hooks/useReviewState.ts"
      via: "hook import and usage"
      pattern: "useReviewState"
    - from: "frontend/src/components/CheckResults/CheckResults.tsx"
      to: "frontend/src/components/CheckResults/ReviewSummaryBar.tsx"
      via: "component import"
      pattern: "import.*ReviewSummaryBar"
    - from: "frontend/src/components/CheckResults/CheckResults.tsx"
      to: "frontend/src/components/CheckResults/CategorySection.tsx"
      via: "passing review props"
      pattern: "selectedIds|onToggleSelect"
---

<objective>
Integrate useReviewState hook into CheckResults, wire up all review components, and add CSS styling for the complete review interface.

Purpose: Complete the review interface integration so users can select issues, add notes, and filter results.
Output: Fully functional review interface with styling.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/LEARNINGS.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-review-interface/05-CONTEXT.md
@.planning/phases/05-review-interface/05-RESEARCH.md
@.planning/phases/05-review-interface/05-01-SUMMARY.md
@.planning/phases/05-review-interface/05-02-SUMMARY.md
@frontend/src/components/CheckResults/CheckResults.tsx
@frontend/src/components/CheckResults/CheckResults.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate review state into CheckResults</name>
  <files>frontend/src/components/CheckResults/CheckResults.tsx</files>
  <action>
Wire up the review system in CheckResults.tsx:

1. **Add imports**:
   ```typescript
   import { useReviewState, getIssueId } from '../../hooks/useReviewState';
   import { ReviewSummaryBar } from './ReviewSummaryBar';
   ```

2. **Initialize review state** after combining categories:
   ```typescript
   // Initialize review state with all categories (sorted)
   const reviewState = useReviewState(sortedCategories);
   const {
     selectedIssues,
     notes,
     severityFilter,
     categoryFilter,
     filteredCategories,
     counts,
     toggleSelection,
     selectCategoryIssues,
     deselectCategoryIssues,
     selectAllVisible,
     deselectAll,
     setNote,
     setSeverityFilter,
     setCategoryFilter,
   } = reviewState;
   ```

3. **Generate issue IDs for each category**:
   ```typescript
   // Pre-compute issue IDs for each category
   const categoryIssueIds = useMemo(() => {
     const result: Record<string, string[]> = {};
     for (const category of sortedCategories) {
       result[category.category_id] = category.issues.map((issue, index) =>
         getIssueId(issue, category.category_id, index)
       );
     }
     return result;
   }, [sortedCategories]);
   ```

4. **Add category filter dropdown** in header area (after severity counts):
   ```tsx
   <div className="check-results__filters">
     <select
       value={categoryFilter}
       onChange={(e) => setCategoryFilter(e.target.value)}
       className="check-results__category-filter"
     >
       <option value="all">All Categories</option>
       {sortedCategories.map(cat => (
         <option key={cat.category_id} value={cat.category_id}>
           {cat.category_name}
         </option>
       ))}
     </select>
   </div>
   ```

5. **Pass review props to CategorySection**:
   ```tsx
   {filteredCategories.map((category) => (
     <CategorySection
       key={category.category_id}
       category={category}
       issueIds={categoryIssueIds[category.category_id]}
       selectedIds={selectedIssues}
       notes={notes}
       onToggleSelect={toggleSelection}
       onSelectCategory={() => selectCategoryIssues(category.category_id, categoryIssueIds[category.category_id])}
       onDeselectCategory={() => deselectCategoryIssues(category.category_id, categoryIssueIds[category.category_id])}
       onNoteChange={setNote}
     />
   ))}
   ```

6. **Add ReviewSummaryBar at bottom** (before footer):
   ```tsx
   <ReviewSummaryBar
     counts={counts}
     severityFilter={severityFilter}
     onFilterChange={setSeverityFilter}
     onSelectAllVisible={() => {
       // Get all visible issue IDs
       const visibleIds = filteredCategories.flatMap(cat =>
         categoryIssueIds[cat.category_id] || []
       );
       selectAllVisible(visibleIds);
     }}
     onDeselectAll={deselectAll}
     canGenerateReport={counts.selected > 0}
   />
   ```

7. **Add padding at bottom** to prevent content being hidden behind fixed summary bar:
   Add className `check-results--has-summary-bar` when results exist.

8. **Update empty state** when filters hide all issues:
   If filteredCategories is empty but sortedCategories has issues, show "No issues match current filters" message.
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`</verify>
  <done>CheckResults integrates review state and passes all props to child components</done>
</task>

<task type="auto">
  <name>Task 2: Add CSS styling for review features</name>
  <files>frontend/src/components/CheckResults/CheckResults.css</files>
  <action>
Add CSS for all review interface elements. Append to existing CheckResults.css:

```css
/* ===== REVIEW INTERFACE STYLES ===== */

/* Padding for fixed summary bar */
.check-results--has-summary-bar {
  padding-bottom: 80px;
}

/* Category filter dropdown */
.check-results__filters {
  margin-left: auto;
}

.check-results__category-filter {
  padding: 6px 12px;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  background: #fff;
  font-size: 13px;
  color: #495057;
  cursor: pointer;
}

.check-results__category-filter:focus {
  outline: none;
  border-color: #1976d2;
  box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
}

/* Filter empty state */
.check-results__filter-empty {
  padding: 40px;
  text-align: center;
  color: #6c757d;
  font-size: 14px;
  background: #f8f9fa;
  border: 1px dashed #dee2e6;
  border-radius: 6px;
}

/* ===== IssueCard Review Styles ===== */

.issue-card--selected {
  background: #e3f2fd;
  border-color: #1976d2;
}

.issue-card__selection {
  display: flex;
  align-items: center;
  padding-right: 8px;
}

.issue-card__checkbox {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #1976d2;
}

.issue-card__notes-section {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid #e9ecef;
}

.issue-card__notes-label {
  display: block;
  margin-bottom: 6px;
  font-size: 12px;
  font-weight: 600;
  color: #666;
}

.issue-card__notes {
  width: 100%;
  padding: 8px;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  font-size: 13px;
  font-family: inherit;
  resize: vertical;
  min-height: 50px;
}

.issue-card__notes:focus {
  outline: none;
  border-color: #1976d2;
  box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
}

.issue-card__notes-count {
  display: block;
  margin-top: 4px;
  text-align: right;
  font-size: 11px;
  color: #999;
}

/* ===== CategorySection Review Styles ===== */

.category-section__selection {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: auto;
  margin-right: 12px;
}

.category-section__checkbox {
  width: 16px;
  height: 16px;
  cursor: pointer;
  accent-color: #1976d2;
}

.category-section__selection-count {
  font-size: 12px;
  color: #6c757d;
  font-weight: normal;
}

/* ===== ReviewSummaryBar Styles ===== */

.review-summary-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 12px 24px;
  background: #fff;
  border-top: 1px solid #dee2e6;
  box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
  z-index: 100;
}

.review-summary-bar__counts {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #333;
}

.review-summary-bar__total {
  font-weight: 600;
}

.review-summary-bar__selected {
  color: #1976d2;
}

.review-summary-bar__breakdown {
  color: #6c757d;
}

.review-summary-bar__error-count {
  color: #dc3545;
}

.review-summary-bar__warning-count {
  color: #856404;
}

.review-summary-bar__filters {
  display: flex;
  gap: 4px;
  margin-left: auto;
}

.review-summary-bar__filter-btn {
  padding: 6px 12px;
  border: 1px solid #dee2e6;
  background: #fff;
  font-size: 13px;
  color: #495057;
  cursor: pointer;
  transition: all 0.15s ease;
}

.review-summary-bar__filter-btn:first-child {
  border-radius: 4px 0 0 4px;
}

.review-summary-bar__filter-btn:last-child {
  border-radius: 0 4px 4px 0;
}

.review-summary-bar__filter-btn:not(:last-child) {
  border-right: none;
}

.review-summary-bar__filter-btn:hover {
  background: #f8f9fa;
}

.review-summary-bar__filter-btn--active {
  background: #1976d2;
  border-color: #1976d2;
  color: #fff;
}

.review-summary-bar__filter-btn--active:hover {
  background: #1565c0;
}

.review-summary-bar__actions {
  display: flex;
  gap: 8px;
}

.review-summary-bar__action-btn {
  padding: 6px 12px;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  background: #fff;
  font-size: 13px;
  color: #495057;
  cursor: pointer;
  transition: all 0.15s ease;
}

.review-summary-bar__action-btn:hover {
  background: #f8f9fa;
  border-color: #ced4da;
}

.review-summary-bar__generate-btn {
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  background: #1976d2;
  font-size: 14px;
  font-weight: 500;
  color: #fff;
  cursor: pointer;
  transition: all 0.15s ease;
}

.review-summary-bar__generate-btn:hover:not(:disabled) {
  background: #1565c0;
}

.review-summary-bar__generate-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
}
```

Match existing color scheme: primary blue #1976d2, error red #dc3545, warning amber #856404/#ffc107.
  </action>
  <verify>App starts without CSS errors: `cd frontend && npm run dev` (brief check)</verify>
  <done>All review interface elements are styled consistently with existing design</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit`
2. App runs without errors: `python start.py`
3. Review state initializes with errors pre-selected
4. Severity filter buttons toggle and update visible issues
5. Category filter dropdown filters to specific category
6. CategorySection checkbox shows indeterminate when partially selected
7. IssueCard checkbox toggles individual selection
8. Notes textarea accepts input with character count
9. Summary bar fixed at bottom with correct counts
10. Generate Report button disabled when nothing selected
</verification>

<success_criteria>
1. Full integration works end-to-end: load PDF, run checks, review issues
2. Selection state persists across filter changes
3. Visual styling consistent with existing CheckResults design
4. Performance acceptable with 50+ issues (no lag on checkbox clicks)
</success_criteria>

<output>
After completion, create `.planning/phases/05-review-interface/05-03-SUMMARY.md`
</output>
