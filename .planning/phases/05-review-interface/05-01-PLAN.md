---
phase: 05-review-interface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/review.ts
  - frontend/src/hooks/useReviewState.ts
  - frontend/src/components/CheckResults/ReviewSummaryBar.tsx
autonomous: true

must_haves:
  truths:
    - "Review state hook provides selection, notes, and filter management"
    - "Summary bar displays total issues, selected count, error/warning breakdown"
    - "Filter buttons toggle between All/Errors/Warnings views"
  artifacts:
    - path: "frontend/src/types/review.ts"
      provides: "ReviewState, ReviewAction, SeverityFilter types"
      exports: ["ReviewState", "ReviewAction", "SeverityFilter", "ReviewCounts"]
    - path: "frontend/src/hooks/useReviewState.ts"
      provides: "Review state management with useReducer"
      exports: ["useReviewState", "getIssueId"]
    - path: "frontend/src/components/CheckResults/ReviewSummaryBar.tsx"
      provides: "Summary bar with counts and filter buttons"
      exports: ["ReviewSummaryBar"]
  key_links:
    - from: "frontend/src/hooks/useReviewState.ts"
      to: "frontend/src/types/review.ts"
      via: "type imports"
      pattern: "import.*from.*types/review"
    - from: "frontend/src/hooks/useReviewState.ts"
      to: "frontend/src/types/checks.ts"
      via: "CategoryResult import"
      pattern: "import.*CategoryResult.*from.*types/checks"
---

<objective>
Create the review state management foundation: TypeScript types, useReviewState hook with reducer pattern, and ReviewSummaryBar component.

Purpose: Enable selection tracking, notes storage, and severity filtering for the review interface.
Output: Types file, review state hook, and summary bar component ready for integration.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/LEARNINGS.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-review-interface/05-CONTEXT.md
@.planning/phases/05-review-interface/05-RESEARCH.md
@frontend/src/types/checks.ts
@frontend/src/hooks/useRuleSettings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create review types</name>
  <files>frontend/src/types/review.ts</files>
  <action>
Create TypeScript types for the review system:

```typescript
/**
 * TypeScript types for the review interface.
 * Selection, notes, and filtering state for compliance issue review.
 */

/** Severity filter options */
export type SeverityFilter = 'all' | 'error' | 'warning';

/** Category filter - 'all' or specific category_id */
export type CategoryFilter = 'all' | string;

/**
 * Review state managed by useReviewState reducer.
 */
export interface ReviewState {
  /** Set of selected issue IDs (for report inclusion) */
  selectedIssues: Set<string>;
  /** Map of issue ID to reviewer note text */
  notes: Record<string, string>;
  /** Current severity filter */
  severityFilter: SeverityFilter;
  /** Current category filter */
  categoryFilter: CategoryFilter;
}

/**
 * Computed counts from review state.
 */
export interface ReviewCounts {
  total: number;
  selected: number;
  errors: number;
  warnings: number;
  visibleSelected: number;  // Selected among currently visible issues
}

/**
 * Actions for the review state reducer.
 */
export type ReviewAction =
  | { type: 'TOGGLE_SELECTION'; issueId: string }
  | { type: 'SELECT_CATEGORY'; categoryId: string; issueIds: string[] }
  | { type: 'DESELECT_CATEGORY'; categoryId: string; issueIds: string[] }
  | { type: 'SELECT_ALL_VISIBLE'; issueIds: string[] }
  | { type: 'DESELECT_ALL' }
  | { type: 'SET_NOTE'; issueId: string; note: string }
  | { type: 'SET_SEVERITY_FILTER'; filter: SeverityFilter }
  | { type: 'SET_CATEGORY_FILTER'; filter: CategoryFilter }
  | { type: 'INITIALIZE_SELECTION'; errorIds: string[] }
  | { type: 'RESET' };
```

Include JSDoc comments explaining each type's purpose.
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`</verify>
  <done>Review types file exists with all required type definitions</done>
</task>

<task type="auto">
  <name>Task 2: Create useReviewState hook</name>
  <files>frontend/src/hooks/useReviewState.ts</files>
  <action>
Create the review state hook following the useRuleSettings.ts reducer pattern:

Key implementation details:
1. **getIssueId function**: Generate stable unique IDs from issue properties
   ```typescript
   export function getIssueId(issue: CheckIssue, categoryId: string, index: number): string {
     return `${categoryId}-${issue.rule_id}-${issue.pages.join(',')}-${index}`;
   }
   ```

2. **reviewReducer**: Handle all ReviewAction types:
   - TOGGLE_SELECTION: Add/remove single issue from Set
   - SELECT_CATEGORY/DESELECT_CATEGORY: Bulk add/remove for category
   - SELECT_ALL_VISIBLE: Add all visible (filtered) issues
   - DESELECT_ALL: Clear selection Set
   - SET_NOTE: Update notes Record
   - SET_SEVERITY_FILTER/SET_CATEGORY_FILTER: Update filters
   - INITIALIZE_SELECTION: Pre-select all error issues (called once on mount)
   - RESET: Clear all state

3. **useReviewState hook**:
   - Accept `categories: CategoryResult[]` parameter
   - Use useReducer with initial state: empty Set, empty Record, 'all' filters
   - Use useEffect to initialize selection with error issues when categories change
   - Memoize filtered categories with useMemo (filter by severity and category)
   - Memoize counts with useMemo
   - Return stable callbacks with useCallback for all actions
   - Return: selectedIssues, notes, severityFilter, categoryFilter, filteredCategories, counts, and all action callbacks

4. **Per CONTEXT.md decisions**:
   - Errors pre-selected by default
   - Selection persists across filter changes
   - Select visible items only for select-all

Export both `useReviewState` and `getIssueId`.
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`</verify>
  <done>useReviewState hook exports correctly and follows reducer pattern from useRuleSettings.ts</done>
</task>

<task type="auto">
  <name>Task 3: Create ReviewSummaryBar component</name>
  <files>frontend/src/components/CheckResults/ReviewSummaryBar.tsx</files>
  <action>
Create the summary bar component per CONTEXT.md specifications:

```typescript
import type { SeverityFilter, ReviewCounts } from '../../types/review';

interface ReviewSummaryBarProps {
  counts: ReviewCounts;
  severityFilter: SeverityFilter;
  onFilterChange: (filter: SeverityFilter) => void;
  onSelectAllVisible: () => void;
  onDeselectAll: () => void;
  canGenerateReport: boolean;  // true if any issues selected
}

export function ReviewSummaryBar({ ... }: ReviewSummaryBarProps) {
  // Render:
  // 1. Counts section: "12 issues (8 selected) - 5 Errors, 7 Warnings"
  // 2. Filter toggle buttons: All / Errors / Warnings (active state styling)
  // 3. Selection actions: Select All Visible / Deselect All buttons
  // 4. Generate Report button (disabled when nothing selected, with tooltip)
}
```

Component structure:
- Use BEM naming: `review-summary-bar`, `review-summary-bar__counts`, etc.
- Fixed position at bottom per CONTEXT.md (CSS in next plan)
- Filter buttons are toggle buttons, not radio inputs
- Show "X selected (Y visible)" when filter hides selected items
- Generate Report button disabled with title="Select at least one issue" when nothing selected

Do NOT add CSS yet - that's in plan 03.
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`</verify>
  <done>ReviewSummaryBar component renders counts, filters, and actions with proper props interface</done>
</task>

</tasks>

<verification>
1. All three files exist and export their types/functions/components
2. TypeScript compiles: `cd frontend && npx tsc --noEmit`
3. useReviewState hook matches the pattern established in useRuleSettings.ts
4. getIssueId generates deterministic unique IDs
5. ReviewSummaryBar accepts all required props for integration
</verification>

<success_criteria>
1. Types define all state, actions, and derived values for review system
2. Hook provides complete review state management with memoized derived state
3. Summary bar component ready for styling and integration
4. All code follows existing BEM and TypeScript conventions
</success_criteria>

<output>
After completion, create `.planning/phases/05-review-interface/05-01-SUMMARY.md`
</output>
