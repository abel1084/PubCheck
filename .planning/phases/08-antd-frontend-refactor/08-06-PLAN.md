---
phase: 08-antd-frontend-refactor
plan: 06
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - frontend/src/components/ReviewResults/ReviewResults.tsx
  - frontend/src/components/ReviewResults/ReviewSection.tsx
  - frontend/src/components/ReviewResults/ReviewResults.css
  - frontend/src/components/CommentList/CommentList.tsx
  - frontend/src/components/CommentList/CommentList.css
autonomous: true

must_haves:
  truths:
    - "Review results display with section cards"
    - "Sections can expand/collapse"
    - "Error state shows with Alert component"
    - "Loading state shows with Spin component"
    - "Comment list displays selectable issues"
    - "User can select/deselect issues"
    - "Generate PDF button works"
  artifacts:
    - path: "frontend/src/components/ReviewResults/ReviewResults.tsx"
      provides: "Review results using antd components"
      contains: "Alert"
    - path: "frontend/src/components/CommentList/CommentList.tsx"
      provides: "Selectable comment list using antd Collapse and Checkbox"
      contains: "Collapse"
  key_links:
    - from: "frontend/src/components/CommentList/CommentList.tsx"
      to: "App.tsx onToggleSelect"
      via: "Checkbox onChange"
      pattern: "onToggleSelect"
---

<objective>
Replace ReviewResults and CommentList components with Ant Design equivalents: Card for sections, Alert for errors, Spin for loading, Collapse for collapsible content, Checkbox for selection, and Button for actions.

Purpose: Consistent styling with the rest of the application; better accessibility from antd components.

Output: ReviewResults and CommentList using antd Card, Alert, Spin, Collapse, Checkbox, Button.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/08-antd-frontend-refactor/08-RESEARCH.md
@frontend/src/components/ReviewResults/ReviewResults.tsx
@frontend/src/components/ReviewResults/ReviewSection.tsx
@frontend/src/components/CommentList/CommentList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace ReviewResults with antd components</name>
  <files>
    frontend/src/components/ReviewResults/ReviewResults.tsx
    frontend/src/components/ReviewResults/ReviewSection.tsx
    frontend/src/components/ReviewResults/ReviewResults.css
  </files>
  <action>
1. Rewrite `frontend/src/components/ReviewResults/ReviewSection.tsx`:

```typescript
import { useState } from 'react';
import { Card, Typography, Spin, Tag } from 'antd';
import { CaretRightOutlined } from '@ant-design/icons';
import ReactMarkdown from 'react-markdown';

const { Title, Text } = Typography;

interface ReviewSectionProps {
  title: string;
  content: string;
  variant: 'overview' | 'attention' | 'good' | 'suggestions';
  isStreaming?: boolean;
}

const variantConfig = {
  overview: { color: '#1890ff', tagColor: 'processing' },
  attention: { color: '#ff4d4f', tagColor: 'error' },
  good: { color: '#52c41a', tagColor: 'success' },
  suggestions: { color: '#faad14', tagColor: 'warning' },
};

export function ReviewSection({ title, content, variant, isStreaming }: ReviewSectionProps) {
  const [collapsed, setCollapsed] = useState(false);
  const config = variantConfig[variant];

  if (!content && !isStreaming) {
    return null;
  }

  return (
    <Card
      size="small"
      style={{ marginBottom: 12, borderLeft: `3px solid ${config.color}` }}
      title={
        <div
          style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}
          onClick={() => setCollapsed(!collapsed)}
        >
          <CaretRightOutlined
            style={{
              marginRight: 8,
              transform: collapsed ? 'rotate(0deg)' : 'rotate(90deg)',
              transition: 'transform 0.2s',
            }}
          />
          <span>{title}</span>
          {isStreaming && (
            <Tag color={config.tagColor} style={{ marginLeft: 8 }}>
              Streaming...
            </Tag>
          )}
        </div>
      }
    >
      {!collapsed && (
        <>
          {isStreaming && !content && (
            <div style={{ textAlign: 'center', padding: 16 }}>
              <Spin size="small" />
            </div>
          )}
          {content && (
            <div className="markdown-content">
              <ReactMarkdown>{content}</ReactMarkdown>
            </div>
          )}
        </>
      )}
    </Card>
  );
}
```

2. Rewrite `frontend/src/components/ReviewResults/ReviewResults.tsx`:

```typescript
import { Alert, Button, Spin, Typography, Space, Result } from 'antd';
import { SyncOutlined } from '@ant-design/icons';
import type { AIReviewSections } from '../../types/review';
import { ReviewSection } from './ReviewSection';

const { Title, Text } = Typography;

interface ReviewResultsProps {
  sections: AIReviewSections;
  isStreaming: boolean;
  isComplete: boolean;
  error: string | null;
  onRetry?: () => void;
}

export function ReviewResults({
  sections,
  isStreaming,
  isComplete,
  error,
  onRetry,
}: ReviewResultsProps) {
  // Error state
  if (error) {
    return (
      <Alert
        message="Review Failed"
        description={error}
        type="error"
        showIcon
        action={
          onRetry && (
            <Button size="small" onClick={onRetry}>
              Try Again
            </Button>
          )
        }
        style={{ margin: 16 }}
      />
    );
  }

  // Empty state before review
  const hasContent = Object.values(sections).some(s => s.length > 0);
  if (!hasContent && !isStreaming) {
    return (
      <Result
        status="info"
        title="No Review Yet"
        subTitle="Click 'Review' to analyze the document for design compliance."
        style={{ padding: 40 }}
      />
    );
  }

  // Loading state
  if (isStreaming && !hasContent) {
    return (
      <div style={{ textAlign: 'center', padding: 60 }}>
        <Spin size="large" />
        <Text style={{ display: 'block', marginTop: 16 }}>
          Analyzing document...
        </Text>
      </div>
    );
  }

  return (
    <div style={{ padding: 16 }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
        <Title level={4} style={{ margin: 0 }}>Design Review</Title>
        <Space>
          {isComplete && <Text type="success">Review Complete</Text>}
          {isStreaming && <Text type="secondary"><SyncOutlined spin /> Reviewing...</Text>}
        </Space>
      </div>

      <ReviewSection
        title="Overview"
        content={sections.overview}
        variant="overview"
        isStreaming={isStreaming && !sections.needsAttention}
      />

      <ReviewSection
        title="Needs Attention"
        content={sections.needsAttention}
        variant="attention"
        isStreaming={isStreaming && !!sections.overview && !sections.lookingGood}
      />

      <ReviewSection
        title="Looking Good"
        content={sections.lookingGood}
        variant="good"
        isStreaming={isStreaming && !!sections.needsAttention && !sections.suggestions}
      />

      <ReviewSection
        title="Suggestions"
        content={sections.suggestions}
        variant="suggestions"
        isStreaming={isStreaming && !!sections.lookingGood}
      />

      {onRetry && isComplete && (
        <div style={{ marginTop: 16, textAlign: 'center' }}>
          <Button onClick={onRetry} icon={<SyncOutlined />}>
            Re-review
          </Button>
        </div>
      )}
    </div>
  );
}

export { ReviewSection } from './ReviewSection';
```

3. Delete `frontend/src/components/ReviewResults/ReviewResults.css`

Key changes:
- Card component for each section
- Alert for error state
- Result for empty state (more visual than plain text)
- Spin for loading state
- Card title is clickable for expand/collapse
- CaretRightOutlined icon rotates on collapse
- Tag shows streaming status
- Typography components for text hierarchy
  </action>
  <verify>npm run build compiles ReviewResults and ReviewSection without errors</verify>
  <done>ReviewResults uses antd Card, Alert, Result, Spin; ReviewResults.css deleted</done>
</task>

<task type="auto">
  <name>Task 2: Replace CommentList with antd components</name>
  <files>
    frontend/src/components/CommentList/CommentList.tsx
    frontend/src/components/CommentList/CommentList.css
  </files>
  <action>
1. Rewrite `frontend/src/components/CommentList/CommentList.tsx`:

```typescript
import { useState } from 'react';
import { Collapse, Checkbox, Button, Typography, Empty, Tag, Space, Affix, type CollapseProps } from 'antd';
import { FilePdfOutlined, DownOutlined, UpOutlined } from '@ant-design/icons';
import type { ReviewIssue } from '../../types/review';

const { Text, Title } = Typography;

interface CommentListProps {
  issues: ReviewIssue[];
  selectedIds: Set<string>;
  onToggleSelect: (id: string) => void;
  onGeneratePdf?: () => void;
  isGenerating?: boolean;
}

export function CommentList({
  issues,
  selectedIds,
  onToggleSelect,
  onGeneratePdf,
  isGenerating = false,
}: CommentListProps) {
  const [expandedIds, setExpandedIds] = useState<string[]>([]);

  // Group issues by category
  const needsAttention = issues.filter(i => i.category === 'needs_attention');
  const suggestions = issues.filter(i => i.category === 'suggestion');

  if (issues.length === 0) {
    return (
      <Empty
        description="No issues found. Run a review to see selectable comments."
        style={{ padding: 40 }}
      />
    );
  }

  // Create section with checkbox header
  const renderSection = (
    title: string,
    sectionIssues: ReviewIssue[],
    variant: 'error' | 'warning'
  ) => {
    if (sectionIssues.length === 0) return null;

    const selectedInSection = sectionIssues.filter(i => selectedIds.has(i.id)).length;
    const allSelected = selectedInSection === sectionIssues.length;
    const someSelected = selectedInSection > 0 && !allSelected;

    const handleSectionToggle = () => {
      if (allSelected) {
        sectionIssues.forEach(i => {
          if (selectedIds.has(i.id)) onToggleSelect(i.id);
        });
      } else {
        sectionIssues.forEach(i => {
          if (!selectedIds.has(i.id)) onToggleSelect(i.id);
        });
      }
    };

    const collapseItems: CollapseProps['items'] = sectionIssues.map(issue => ({
      key: issue.id,
      label: (
        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }} onClick={e => e.stopPropagation()}>
          <Checkbox
            checked={selectedIds.has(issue.id)}
            onChange={() => onToggleSelect(issue.id)}
          />
          <Text strong style={{ flex: 1 }}>{issue.title}</Text>
          <Tag>
            {issue.pages.length === 1
              ? `p. ${issue.pages[0]}`
              : `pp. ${issue.pages.join(', ')}`}
          </Tag>
        </div>
      ),
      children: <Text type="secondary">{issue.description}</Text>,
    }));

    return (
      <div style={{ marginBottom: 16 }}>
        <div style={{
          display: 'flex',
          alignItems: 'center',
          padding: '8px 12px',
          background: variant === 'error' ? '#fff2f0' : '#fffbe6',
          borderLeft: `3px solid ${variant === 'error' ? '#ff4d4f' : '#faad14'}`,
          marginBottom: 8,
        }}>
          <Checkbox
            checked={allSelected}
            indeterminate={someSelected}
            onChange={handleSectionToggle}
          />
          <Text strong style={{ marginLeft: 8, flex: 1 }}>{title}</Text>
          <Text type="secondary">{selectedInSection}/{sectionIssues.length}</Text>
        </div>
        <Collapse
          activeKey={expandedIds}
          onChange={(keys) => setExpandedIds(keys as string[])}
          items={collapseItems}
          ghost
          expandIcon={({ isActive }) => isActive ? <UpOutlined /> : <DownOutlined />}
        />
      </div>
    );
  };

  const totalSelected = selectedIds.size;

  return (
    <div style={{ padding: 16, paddingBottom: 80 }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
        <Title level={5} style={{ margin: 0 }}>Comments for PDF</Title>
        <Text type="secondary">{totalSelected} of {issues.length} selected</Text>
      </div>

      {renderSection('Needs Attention', needsAttention, 'error')}
      {renderSection('Suggestions', suggestions, 'warning')}

      {onGeneratePdf && (
        <Affix offsetBottom={0}>
          <div style={{
            background: '#fff',
            padding: 16,
            borderTop: '1px solid #f0f0f0',
            display: 'flex',
            justifyContent: 'flex-end',
          }}>
            <Button
              type="primary"
              icon={<FilePdfOutlined />}
              onClick={onGeneratePdf}
              disabled={totalSelected === 0}
              loading={isGenerating}
            >
              Generate PDF ({totalSelected} comments)
            </Button>
          </div>
        </Affix>
      )}
    </div>
  );
}
```

2. Delete `frontend/src/components/CommentList/CommentList.css`

Key changes:
- Collapse with ghost style for issue list
- Checkbox in collapse header (with stopPropagation to prevent toggle)
- Section header with indeterminate checkbox for select all
- Tag for page numbers
- Affix for sticky footer with Generate PDF button
- Empty component for no issues state
- Typography components for text hierarchy
- Colored section headers (red for attention, yellow for suggestions)
  </action>
  <verify>npm run build compiles CommentList.tsx without errors</verify>
  <done>CommentList uses antd Collapse, Checkbox, Button, Affix; CommentList.css deleted</done>
</task>

</tasks>

<verification>
1. `npm run build` completes successfully
2. ReviewResults displays with Card sections
3. Sections can collapse/expand by clicking header
4. Error state shows Alert with retry button
5. Empty state shows Result component
6. Loading state shows Spin with message
7. CommentList displays issues grouped by category
8. Checkboxes work for individual and section selection
9. Generate PDF button shows at bottom (sticky with Affix)
10. No ReviewResults.css or CommentList.css files exist
</verification>

<success_criteria>
- ReviewResults uses antd Card, Alert, Result, Spin
- ReviewSection collapses/expands on click
- CommentList uses antd Collapse, Checkbox, Affix
- Section headers have indeterminate checkbox support
- Generate PDF uses antd Button with loading state
- ReviewResults.css and CommentList.css deleted
- All functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/08-antd-frontend-refactor/08-06-SUMMARY.md`
</output>
