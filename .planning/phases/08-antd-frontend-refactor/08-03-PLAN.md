---
phase: 08-antd-frontend-refactor
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/SortableTable/SortableTable.tsx
  - frontend/src/components/SortableTable/SortableTable.css
  - frontend/src/components/DataTabs/DataTabs.tsx
  - frontend/src/components/DataTabs/TextTab.tsx
  - frontend/src/components/DataTabs/ImagesTab.tsx
  - frontend/src/components/DataTabs/MarginsTab.tsx
  - frontend/src/components/DataTabs/MetadataTab.tsx
  - frontend/src/components/DataTabs/DataTabs.css
autonomous: true

must_haves:
  truths:
    - "Tables display data with sortable columns"
    - "Clicking column header sorts ascending/descending"
    - "Tabs switch between Text, Images, Margins, Metadata views"
    - "Extracted Data section can collapse/expand"
  artifacts:
    - path: "frontend/src/components/SortableTable/SortableTable.tsx"
      provides: "Generic sortable table using antd Table"
      contains: "Table"
    - path: "frontend/src/components/DataTabs/DataTabs.tsx"
      provides: "Collapsible tabs using antd Collapse and Tabs"
      contains: "Collapse"
  key_links:
    - from: "frontend/src/components/DataTabs/TextTab.tsx"
      to: "SortableTable component"
      via: "component import"
      pattern: "import.*SortableTable"
---

<objective>
Replace TanStack Table with Ant Design Table and custom tabs with Ant Design Tabs. The SortableTable component becomes a thin wrapper around antd Table, and DataTabs uses Collapse for the collapsible header and Tabs for content switching.

Purpose: Ant Design Table provides built-in sorting, pagination, and accessibility. Tabs provides consistent navigation. Collapse handles the expand/collapse pattern cleanly.

Output: All data tables use antd Table with sorting; DataTabs uses antd Collapse and Tabs.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/08-antd-frontend-refactor/08-RESEARCH.md
@frontend/src/components/SortableTable/SortableTable.tsx
@frontend/src/components/DataTabs/DataTabs.tsx
@frontend/src/components/DataTabs/TextTab.tsx
@frontend/src/components/DataTabs/ImagesTab.tsx
@frontend/src/components/DataTabs/MarginsTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace SortableTable with Ant Design Table wrapper</name>
  <files>
    frontend/src/components/SortableTable/SortableTable.tsx
    frontend/src/components/SortableTable/SortableTable.css
  </files>
  <action>
1. Rewrite `frontend/src/components/SortableTable/SortableTable.tsx`:

```typescript
import { Table, Empty } from 'antd';
import type { TableProps, ColumnsType } from 'antd/es/table';

// Re-export ColumnsType for consumers
export type { ColumnsType };

interface SortableTableProps<T extends object> {
  data: T[];
  columns: ColumnsType<T>;
  rowKey?: string | ((record: T) => string);
  emptyMessage?: string;
}

export function SortableTable<T extends object>({
  data,
  columns,
  rowKey = 'id',
  emptyMessage = 'No data available',
}: SortableTableProps<T>) {
  // Add sorter to each column that has a dataIndex
  const columnsWithSort: ColumnsType<T> = columns.map((col) => {
    // Only add sorter if not already defined and has dataIndex
    if ('dataIndex' in col && col.dataIndex && !col.sorter) {
      const dataIndex = col.dataIndex as keyof T;
      return {
        ...col,
        sorter: (a: T, b: T) => {
          const aVal = a[dataIndex];
          const bVal = b[dataIndex];
          if (typeof aVal === 'number' && typeof bVal === 'number') {
            return aVal - bVal;
          }
          if (typeof aVal === 'string' && typeof bVal === 'string') {
            return aVal.localeCompare(bVal);
          }
          return 0;
        },
      };
    }
    return col;
  });

  if (data.length === 0) {
    return <Empty description={emptyMessage} />;
  }

  return (
    <Table<T>
      columns={columnsWithSort}
      dataSource={data}
      rowKey={rowKey}
      pagination={false}
      size="small"
      scroll={{ x: true }}
    />
  );
}
```

2. Delete `frontend/src/components/SortableTable/SortableTable.css`

Key changes:
- Props interface simplified: data, columns (antd ColumnsType), rowKey, emptyMessage
- No more TanStack Table imports
- Columns auto-get sorter function based on dataIndex type
- Empty state uses antd Empty component
- Pagination disabled (matching original behavior)
- Small size and horizontal scroll for dense data
  </action>
  <verify>TypeScript compiles without errors for SortableTable.tsx</verify>
  <done>SortableTable uses antd Table with auto-sorting; CSS deleted</done>
</task>

<task type="auto">
  <name>Task 2: Update tab components to use antd Table columns format</name>
  <files>
    frontend/src/components/DataTabs/TextTab.tsx
    frontend/src/components/DataTabs/ImagesTab.tsx
    frontend/src/components/DataTabs/MarginsTab.tsx
    frontend/src/components/DataTabs/MetadataTab.tsx
  </files>
  <action>
Update each tab component to use antd ColumnsType instead of TanStack ColumnDef.

1. Update `TextTab.tsx`:
```typescript
import { SortableTable, type ColumnsType } from '../SortableTable/SortableTable';
import type { FontInfo } from '../../types/extraction';

interface TextTabProps {
  fonts: FontInfo[];
  textBlocks: Array<{ page: number; content: string }>;
}

export function TextTab({ fonts }: TextTabProps) {
  const columns: ColumnsType<FontInfo> = [
    { title: 'Font', dataIndex: 'name', key: 'name' },
    { title: 'Size', dataIndex: 'size', key: 'size', render: (v: number) => `${v}pt` },
    { title: 'Count', dataIndex: 'count', key: 'count' },
  ];

  return <SortableTable data={fonts} columns={columns} rowKey="name" />;
}
```

2. Update `ImagesTab.tsx`:
```typescript
import { SortableTable, type ColumnsType } from '../SortableTable/SortableTable';
import type { ImageInfo } from '../../types/extraction';

interface ImagesTabProps {
  images: ImageInfo[];
}

export function ImagesTab({ images }: ImagesTabProps) {
  const columns: ColumnsType<ImageInfo & { key: string }> = [
    { title: 'Page', dataIndex: 'page', key: 'page' },
    { title: 'DPI', dataIndex: 'dpi', key: 'dpi', render: (v: number) => v.toFixed(0) },
    {
      title: 'Dimensions',
      key: 'dimensions',
      render: (_, record) => `${record.width_mm.toFixed(1)} x ${record.height_mm.toFixed(1)} mm`,
    },
    { title: 'Color Space', dataIndex: 'color_space', key: 'color_space' },
  ];

  // Add key to each image for rowKey
  const dataWithKeys = images.map((img, i) => ({ ...img, key: `${img.page}-${i}` }));

  return (
    <SortableTable
      data={dataWithKeys}
      columns={columns}
      rowKey="key"
      emptyMessage="No images found"
    />
  );
}
```

3. Update `MarginsTab.tsx`:
```typescript
import { SortableTable, type ColumnsType } from '../SortableTable/SortableTable';
import type { PageMargins } from '../../types/extraction';

interface MarginsTabProps {
  margins: PageMargins[];
}

export function MarginsTab({ margins }: MarginsTabProps) {
  const formatMm = (v: number) => `${v.toFixed(1)} mm`;

  const columns: ColumnsType<PageMargins> = [
    { title: 'Page', dataIndex: 'page', key: 'page' },
    { title: 'Top', dataIndex: 'top', key: 'top', render: formatMm },
    { title: 'Bottom', dataIndex: 'bottom', key: 'bottom', render: formatMm },
    { title: 'Inside', dataIndex: 'inside', key: 'inside', render: formatMm },
    { title: 'Outside', dataIndex: 'outside', key: 'outside', render: formatMm },
  ];

  return (
    <SortableTable
      data={margins}
      columns={columns}
      rowKey="page"
      emptyMessage="No margin data available"
    />
  );
}
```

4. Update `MetadataTab.tsx`:
```typescript
import { Descriptions } from 'antd';
import type { DocumentMetadata } from '../../types/extraction';

interface MetadataTabProps {
  metadata: DocumentMetadata;
}

export function MetadataTab({ metadata }: MetadataTabProps) {
  const items = [
    { label: 'Title', children: metadata.title || '-' },
    { label: 'Author', children: metadata.author || '-' },
    { label: 'Pages', children: metadata.page_count },
    { label: 'ISBN', children: metadata.isbn || '-' },
    { label: 'DOI', children: metadata.doi || '-' },
    { label: 'Job Number', children: metadata.job_number || '-' },
  ].filter(item => item.children !== '-');

  return (
    <Descriptions
      column={1}
      size="small"
      items={items.map((item, i) => ({ key: i, ...item }))}
    />
  );
}
```

Key changes:
- TanStack ColumnDef replaced with antd ColumnsType
- accessorKey -> dataIndex
- cell render functions -> render prop
- MetadataTab uses Descriptions component (more appropriate than table)
  </action>
  <verify>npm run build compiles all tab components without errors</verify>
  <done>All tab components use antd Table column format; MetadataTab uses Descriptions</done>
</task>

<task type="auto">
  <name>Task 3: Replace DataTabs with antd Collapse and Tabs</name>
  <files>
    frontend/src/components/DataTabs/DataTabs.tsx
    frontend/src/components/DataTabs/DataTabs.css
  </files>
  <action>
1. Rewrite `frontend/src/components/DataTabs/DataTabs.tsx`:

```typescript
import { useState } from 'react';
import { Collapse, Tabs, type TabsProps } from 'antd';
import type { ExtractionResult } from '../../types/extraction';
import { TextTab } from './TextTab';
import { ImagesTab } from './ImagesTab';
import { MarginsTab } from './MarginsTab';
import { MetadataTab } from './MetadataTab';

interface DataTabsProps {
  extraction: ExtractionResult;
  defaultCollapsed?: boolean;
}

export function DataTabs({ extraction, defaultCollapsed = false }: DataTabsProps) {
  const [activeKey, setActiveKey] = useState(defaultCollapsed ? [] : ['data']);

  const tabItems: TabsProps['items'] = [
    {
      key: 'text',
      label: `Text (${extraction.fonts.length})`,
      children: <TextTab fonts={extraction.fonts} textBlocks={extraction.text_blocks} />
    },
    {
      key: 'images',
      label: `Images (${extraction.images.length})`,
      children: <ImagesTab images={extraction.images} />,
      disabled: extraction.images.length === 0,
    },
    {
      key: 'margins',
      label: `Margins (${extraction.margins.length})`,
      children: <MarginsTab margins={extraction.margins} />,
      disabled: extraction.margins.length === 0,
    },
    {
      key: 'metadata',
      label: 'Metadata',
      children: <MetadataTab metadata={extraction.metadata} />
    },
  ];

  const collapseItems = [
    {
      key: 'data',
      label: 'Extracted Data',
      children: (
        <Tabs
          items={tabItems}
          defaultActiveKey="text"
          size="small"
        />
      ),
    },
  ];

  return (
    <Collapse
      activeKey={activeKey}
      onChange={(keys) => setActiveKey(keys as string[])}
      items={collapseItems}
      style={{ marginTop: 16 }}
    />
  );
}
```

2. Delete `frontend/src/components/DataTabs/DataTabs.css`

Key changes:
- Collapse component handles expand/collapse (replaces custom toggle button)
- Tabs component with items prop (modern API per RESEARCH.md)
- Tab disabled prop for empty data (replaces custom disabled logic)
- activeKey state controls collapse open/closed state
- defaultCollapsed prop controls initial state via activeKey
  </action>
  <verify>npm run build compiles DataTabs.tsx without errors</verify>
  <done>DataTabs uses antd Collapse and Tabs; DataTabs.css deleted</done>
</task>

</tasks>

<verification>
1. `npm run build` completes successfully
2. DataTabs renders with Collapse header "Extracted Data"
3. Clicking Collapse header expands/collapses content
4. Tabs switch between Text, Images, Margins, Metadata
5. Empty tabs (0 items) are disabled
6. Tables display with sortable column headers
7. Clicking column header sorts data ascending/descending
8. No SortableTable.css or DataTabs.css files exist
</verification>

<success_criteria>
- SortableTable uses antd Table with auto-sorting
- Tab components use ColumnsType instead of ColumnDef
- DataTabs uses antd Collapse and Tabs
- MetadataTab uses antd Descriptions
- SortableTable.css and DataTabs.css deleted
- No TanStack Table imports remain
- All tables maintain sorting functionality
</success_criteria>

<output>
After completion, create `.planning/phases/08-antd-frontend-refactor/08-03-SUMMARY.md`
</output>
