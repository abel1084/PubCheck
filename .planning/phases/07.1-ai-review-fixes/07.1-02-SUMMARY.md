---
phase: 07.1-ai-review-fixes
plan: 02
subsystem: api, ui
tags: [dpi, output-format, claude-api, streaming, pdf-review]

# Dependency graph
requires:
  - phase: 07.1-01
    provides: Logo detection improvements for AI review
provides:
  - Output format dropdown (digital/print/both)
  - DPI-aware AI review prompts
  - Backend output_format parameter
affects: [07.1-03, 07.1-04, pdf-output]

# Tech tracking
tech-stack:
  added: []
  patterns: [output-format-aware-dpi-checks]

key-files:
  created: []
  modified:
    - frontend/src/App.tsx
    - frontend/src/hooks/useAIReview.ts
    - backend/app/ai/router.py
    - backend/app/ai/reviewer.py
    - backend/app/ai/prompts.py

key-decisions:
  - "Digital = 72 DPI, Print = 300 DPI, Both = 150 DPI compromise"
  - "DPI requirements added to user prompt, not system prompt"

patterns-established:
  - "Output format passed from frontend through full API chain to AI prompts"

# Metrics
duration: 4min
completed: 2026-02-01
---

# Phase 7.1 Plan 02: Output Format DPI Rules Summary

**Added Print/Digital/Both dropdown for context-aware DPI requirements in AI review prompts**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-01T09:37:20Z
- **Completed:** 2026-02-01T09:41:00Z
- **Tasks:** 4
- **Files modified:** 5

## Accomplishments
- Output format dropdown (digital/print/both) added to App.tsx header
- Frontend hook passes outputFormat parameter to backend
- Backend endpoint accepts and validates output_format
- AI prompts include DPI thresholds based on output format

## Task Commits

All four tasks committed together as single atomic unit:

1. **Task 1: Add output format state to App.tsx** - `5370558`
2. **Task 2: Update useAIReview to accept outputFormat** - `5370558`
3. **Task 3: Accept output_format in backend endpoint** - `5370558`
4. **Task 4: Update reviewer to use output_format for DPI rules** - `5370558`

Note: Task 1 UI was already partially implemented, Task 2 hook changes were from a prior commit. All backend changes (Tasks 3-4) were new in this execution.

## Files Created/Modified
- `frontend/src/App.tsx` - Added OutputFormat type, state, dropdown UI, reset on new document
- `frontend/src/hooks/useAIReview.ts` - Added outputFormat parameter, appends to FormData
- `backend/app/ai/router.py` - Added output_format Form parameter with validation
- `backend/app/ai/reviewer.py` - DPI_REQUIREMENTS dict, passes to prompt builder
- `backend/app/ai/prompts.py` - build_user_prompt includes DPI guidance section

## Decisions Made
- **DPI thresholds:** Digital=72, Print=300, Both=150 (compromise for dual-use)
- **Prompt location:** DPI requirements in user prompt (document-specific), not system prompt (rules-general)
- **Validation:** Backend validates output_format against ["digital", "print", "both"]

## Deviations from Plan

None - plan executed exactly as written.

## Quick Rules Applied

No Quick Rules applied during this plan.

## Issues Encountered

None - straightforward implementation following existing patterns.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Output format now flows from UI to AI prompts
- AI can use DPI thresholds for image quality assessment
- Ready for verification in 07.1-03 or 07.1-08

---
*Phase: 07.1-ai-review-fixes*
*Completed: 2026-02-01*
