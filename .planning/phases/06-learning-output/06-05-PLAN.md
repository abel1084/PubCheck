---
phase: 06-learning-output
plan: 05
type: execute
wave: 3
depends_on: ["06-03", "06-04"]
files_modified:
  - frontend/src/components/Settings/IgnoredRulesTab.tsx
  - frontend/src/components/Settings/Settings.tsx
  - frontend/src/components/Settings/Settings.css
  - frontend/src/components/CheckResults/CheckResults.tsx
  - frontend/src/components/CheckResults/CategorySection.tsx
autonomous: true

must_haves:
  truths:
    - "User can view ignored rules in Settings > Ignored Rules tab"
    - "User can delete ignored rules from Settings"
    - "Ignored rules are filtered out of check results"
    - "Toast with undo appears when ignoring a rule"
    - "PDF generation works with selected issues"
  artifacts:
    - path: "frontend/src/components/Settings/IgnoredRulesTab.tsx"
      provides: "Settings tab showing ignored rules list with delete"
      exports: ["IgnoredRulesTab"]
  key_links:
    - from: "frontend/src/components/CheckResults/CheckResults.tsx"
      to: "frontend/src/hooks/useIgnoredRules.ts"
      via: "hook for filtering"
      pattern: "useIgnoredRules"
    - from: "frontend/src/components/CheckResults/CheckResults.tsx"
      to: "frontend/src/hooks/useGenerateReport.ts"
      via: "hook for PDF generation"
      pattern: "useGenerateReport"
---

<objective>
Complete integration: Settings tab for ignored rules, filtering, and PDF generation wiring.

Purpose: Wire everything together - Settings UI for managing ignored rules, filtering check results, and connecting PDF generation.
Output: Fully functional learning system and PDF output generation.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-learning-output/06-CONTEXT.md
@.planning/phases/06-learning-output/06-RESEARCH.md

# Prior plan outputs
@.planning/phases/06-learning-output/06-03-SUMMARY.md
@.planning/phases/06-learning-output/06-04-SUMMARY.md

# Existing components to modify
@frontend/src/components/Settings/Settings.tsx
@frontend/src/components/CheckResults/CheckResults.tsx
@frontend/src/components/CheckResults/CategorySection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create IgnoredRulesTab and integrate into Settings</name>
  <files>
    frontend/src/components/Settings/IgnoredRulesTab.tsx
    frontend/src/components/Settings/Settings.tsx
    frontend/src/components/Settings/Settings.css
  </files>
  <action>
1. Create `frontend/src/components/Settings/IgnoredRulesTab.tsx`:
```typescript
import type { IgnoredRule } from '../../types/learning';

interface IgnoredRulesTabProps {
  ignoredRules: IgnoredRule[];
  onDelete: (ruleId: string, documentType: string) => void;
  loading: boolean;
}

/**
 * Settings tab displaying list of ignored rules with delete capability.
 */
export function IgnoredRulesTab({ ignoredRules, onDelete, loading }: IgnoredRulesTabProps) {
  if (loading) {
    return <div className="ignored-rules-tab__loading">Loading...</div>;
  }

  if (ignoredRules.length === 0) {
    return (
      <div className="ignored-rules-tab__empty">
        <p>No rules are currently ignored.</p>
        <p className="ignored-rules-tab__hint">
          When reviewing issues, click the X button on an issue to ignore that rule
          for the document type.
        </p>
      </div>
    );
  }

  return (
    <div className="ignored-rules-tab">
      <table className="ignored-rules-tab__table">
        <thead>
          <tr>
            <th>Rule ID</th>
            <th>Document Type</th>
            <th>Reason</th>
            <th>Date Added</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {ignoredRules.map((rule) => (
            <tr key={`${rule.rule_id}-${rule.document_type}`}>
              <td className="ignored-rules-tab__rule-id">{rule.rule_id}</td>
              <td>{rule.document_type}</td>
              <td className="ignored-rules-tab__reason">{rule.reason || '-'}</td>
              <td>{new Date(rule.added_date).toLocaleDateString()}</td>
              <td>
                <button
                  type="button"
                  className="ignored-rules-tab__delete-btn"
                  onClick={() => onDelete(rule.rule_id, rule.document_type)}
                  title="Remove from ignored rules"
                >
                  Delete
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

2. Update `frontend/src/components/Settings/Settings.tsx`:
   - Import `useIgnoredRules` hook
   - Import `IgnoredRulesTab` component
   - Add "Ignored Rules" as a new tab (after existing template tabs)
   - Add tab content rendering for IgnoredRulesTab
   - Wire onDelete to call unignoreRule from hook

Add to tabs array:
```typescript
// After the template tabs, add:
{ id: 'ignored-rules', label: 'Ignored Rules' }
```

Add tab content:
```tsx
{activeTab === 'ignored-rules' && (
  <IgnoredRulesTab
    ignoredRules={ignoredRules}
    onDelete={handleDeleteIgnoredRule}
    loading={ignoredLoading}
  />
)}
```

3. Add CSS to `frontend/src/components/Settings/Settings.css`:
```css
/* Ignored Rules Tab */
.ignored-rules-tab {
  padding: 1rem;
}

.ignored-rules-tab__table {
  width: 100%;
  border-collapse: collapse;
}

.ignored-rules-tab__table th,
.ignored-rules-tab__table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid #e0e0e0;
}

.ignored-rules-tab__table th {
  font-weight: 600;
  color: #555;
  font-size: 0.85rem;
}

.ignored-rules-tab__rule-id {
  font-family: monospace;
  font-size: 0.85rem;
}

.ignored-rules-tab__reason {
  color: #666;
  font-style: italic;
}

.ignored-rules-tab__delete-btn {
  padding: 0.25rem 0.5rem;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  font-size: 0.8rem;
}

.ignored-rules-tab__delete-btn:hover {
  background: #c82333;
}

.ignored-rules-tab__empty {
  padding: 2rem;
  text-align: center;
  color: #666;
}

.ignored-rules-tab__hint {
  font-size: 0.9rem;
  margin-top: 1rem;
}

.ignored-rules-tab__loading {
  padding: 2rem;
  text-align: center;
  color: #888;
}
```
  </action>
  <verify>
    - TypeScript compiles: `cd frontend && npx tsc --noEmit`
    - Settings view has "Ignored Rules" tab
    - Tab shows table when rules exist, empty state otherwise
  </verify>
  <done>
    - IgnoredRulesTab component with table and delete button
    - Integrated into Settings as new tab
    - Proper styling for empty/loaded states
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire ignored rules filtering and PDF generation in CheckResults</name>
  <files>
    frontend/src/components/CheckResults/CheckResults.tsx
    frontend/src/components/CheckResults/CategorySection.tsx
  </files>
  <action>
1. Update `frontend/src/components/CheckResults/CheckResults.tsx`:

Add imports:
```typescript
import { toast } from 'sonner';
import { useIgnoredRules } from '../../hooks/useIgnoredRules';
import { useGenerateReport } from '../../hooks/useGenerateReport';
import { ProgressModal } from '../GenerateReport/ProgressModal';
```

Add hooks in component (documentType comes from props):
```typescript
const { ignoredRuleIds, ignoreRule, unignoreRule } = useIgnoredRules(documentType);
const { isGenerating, generateReport } = useGenerateReport();
```

Filter categories to exclude ignored rules:
```typescript
// After getting categories from check result, filter out ignored rules
const filteredCategories = useMemo(() => {
  if (!checkResult?.categories) return [];

  return checkResult.categories.map(category => ({
    ...category,
    issues: category.issues.filter(issue => !ignoredRuleIds.has(issue.rule_id))
  })).filter(category => category.issues.length > 0);
}, [checkResult?.categories, ignoredRuleIds]);
```

Pass filteredCategories to useReviewState instead of original categories.

Add ignore handler:
```typescript
const handleIgnoreRule = useCallback((ruleId: string) => {
  if (!documentType) return;

  ignoreRule(ruleId, documentType);
  toast.success('Rule ignored for this document type', {
    duration: 5000,
    action: {
      label: 'Undo',
      onClick: () => {
        unignoreRule(ruleId, documentType);
        toast.success('Rule restored');
      },
    },
  });
}, [documentType, ignoreRule, unignoreRule]);
```

Add generate handler:
```typescript
const handleGenerateReport = useCallback(() => {
  if (!pdfFile) return;
  generateReport(pdfFile, filteredCategories, selectedIssues, notes, getIssueId);
}, [pdfFile, filteredCategories, selectedIssues, notes, generateReport]);
```

Wire to ReviewSummaryBar:
```tsx
<ReviewSummaryBar
  counts={counts}
  severityFilter={severityFilter}
  onSeverityFilterChange={setSeverityFilter}
  onSelectAllVisible={selectAllVisible}
  onDeselectAll={deselectAll}
  onGenerateReport={handleGenerateReport}
  isGenerating={isGenerating}
/>
```

Add ProgressModal:
```tsx
<ProgressModal isOpen={isGenerating} message="Generating annotated PDF..." />
```

2. Update `frontend/src/components/CheckResults/CategorySection.tsx`:
   - Add prop: `onIgnoreRule?: (ruleId: string) => void`
   - Pass to each IssueCard: `onIgnoreRule={onIgnoreRule}`

Update CategorySection interface:
```typescript
interface CategorySectionProps {
  category: CheckCategory;
  // ... existing props
  onIgnoreRule?: (ruleId: string) => void;
}
```

Pass to IssueCard:
```tsx
<IssueCard
  key={issueId}
  issue={issue}
  issueId={issueId}
  isSelected={isSelected}
  note={notes[issueId]}
  onToggleSelect={() => onToggleSelect?.(issueId)}
  onNoteChange={(note) => onNoteChange?.(issueId, note)}
  onIgnoreRule={onIgnoreRule}
/>
```
  </action>
  <verify>
    - TypeScript compiles: `cd frontend && npx tsc --noEmit`
    - npm run dev starts without errors
    - After running check, ignored rules are filtered from results
    - Generate Report button triggers PDF download
    - Toast appears with Undo when ignoring a rule
  </verify>
  <done>
    - CheckResults filters out ignored rules before display
    - Ignore button shows toast with undo
    - Generate Report triggers PDF annotation API and downloads
    - ProgressModal shows during generation
  </done>
</task>

</tasks>

<verification>
- [ ] TypeScript compiles without errors
- [ ] Settings shows Ignored Rules tab
- [ ] Can delete ignored rules from Settings
- [ ] Ignored rules filtered from check results
- [ ] Toast appears with Undo when ignoring rule
- [ ] Generate Report creates and downloads annotated PDF
- [ ] Progress modal shows during generation
</verification>

<success_criteria>
- Complete learning system: ignore from issue, manage in Settings
- Complete PDF generation: select issues, generate, download
- All integrations working together
</success_criteria>

<output>
After completion, create `.planning/phases/06-learning-output/06-05-SUMMARY.md`
</output>
