---
phase: 07-ai-first-architecture
plan: 07
type: execute
wave: 3
depends_on: ["07-05"]
files_modified:
  - frontend/src/App.tsx
  - frontend/src/App.css
  - frontend/src/components/DataTabs/DataTabs.tsx
autonomous: true

must_haves:
  truths:
    - "Check button renamed to Review"
    - "Settings button removed from header"
    - "Analyze with AI button removed (now integrated)"
    - "ReviewResults component displays AI review"
    - "Extracted data tabs collapsed by default"
  artifacts:
    - path: "frontend/src/App.tsx"
      provides: "Main application with AI review integration"
      contains: "useAIReview"
    - path: "frontend/src/components/DataTabs/DataTabs.tsx"
      provides: "Data tabs with collapsed default state"
  key_links:
    - from: "frontend/src/App.tsx"
      to: "frontend/src/hooks/useAIReview.ts"
      via: "hook import"
      pattern: "import.*useAIReview"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/components/ReviewResults/ReviewResults.tsx"
      via: "component import"
      pattern: "import.*ReviewResults"
---

<objective>
Update App.tsx to integrate the new AI review system and remove deprecated UI elements.

Purpose: Complete the frontend integration (ARCH-07) by wiring useAIReview to ReviewResults, renaming Check to Review, removing Settings access, and collapsing data tabs by default.

Output: Updated App.tsx with AI review integration, simplified header, collapsed data tabs.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-ai-first-architecture/07-CONTEXT.md
@.planning/phases/07-ai-first-architecture/07-RESEARCH.md
@.planning/phases/07-ai-first-architecture/07-05-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/components/DataTabs/DataTabs.tsx
@frontend/src/hooks/useAIReview.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update App.tsx for AI review integration</name>
  <files>frontend/src/App.tsx</files>
  <action>
Rewrite `frontend/src/App.tsx` to integrate the new AI review system:

**Key changes:**
1. Replace useComplianceCheck and useAIAnalysis with useAIReview
2. Rename "Check" button to "Review"
3. Remove "Analyze with AI" button (now unified)
4. Remove Settings button and showSettings state
5. Remove Settings component import and view
6. Wire ReviewResults component
7. Keep document type dropdown

```tsx
import { useState, useEffect, useRef } from 'react';
import { DropZone } from './components/DropZone';
import { DataTabs } from './components/DataTabs';
import { Sidebar } from './components/Sidebar';
import { ReviewResults } from './components/ReviewResults/ReviewResults';
import { ToastProvider } from './components/Toast/ToastProvider';
import { useExtraction } from './hooks/useExtraction';
import { useAIReview } from './hooks/useAIReview';
import type { DocumentType } from './types/extraction';
import './App.css';

// Map frontend DocumentType to backend document_type IDs
const DOCUMENT_TYPE_MAP: Record<DocumentType, string> = {
  'Factsheet': 'factsheet',
  'Policy Brief': 'policy-brief',
  'Working Paper': 'working-paper',
  'Technical Report': 'issue-note',
  'Publication': 'publication',
};

function App() {
  const { isUploading, error, result, upload, reset } = useExtraction();
  const {
    sections,
    isStreaming,
    isComplete,
    error: reviewError,
    startReview,
    reset: resetReview
  } = useAIReview();

  const [documentType, setDocumentType] = useState<DocumentType | null>(null);
  const uploadedFileRef = useRef<File | null>(null);

  // Sync document type from result when it changes
  useEffect(() => {
    if (result && documentType === null) {
      setDocumentType(result.documentType);
    }
  }, [result, documentType]);

  // Custom upload handler that stores the file
  const handleUpload = (file: File) => {
    uploadedFileRef.current = file;
    upload(file);
  };

  const handleNewDocument = () => {
    reset();
    resetReview();
    setDocumentType(null);
    uploadedFileRef.current = null;
  };

  // Handle review button click
  const handleReview = () => {
    if (result && documentType && uploadedFileRef.current) {
      const docTypeId = DOCUMENT_TYPE_MAP[documentType];
      startReview(
        uploadedFileRef.current,
        result.extraction,
        docTypeId,
        result.confidence
      );
    }
  };

  // Show upload view if no result
  if (!result) {
    return (
      <div className="app app--upload">
        <ToastProvider />
        <header className="app__header">
          <div className="app__header-content">
            <div>
              <h1>PubCheck</h1>
              <p>UNEP PDF Design Compliance Checker</p>
            </div>
          </div>
        </header>
        <main className="app__upload-area">
          <DropZone
            onFileAccepted={handleUpload}
            isProcessing={isUploading}
            error={error}
          />
        </main>
      </div>
    );
  }

  // Show results view
  return (
    <div className="app app--results">
      <ToastProvider />
      <header className="app__header app__header--compact">
        <h1>PubCheck</h1>
        <div className="app__header-buttons">
          <button
            type="button"
            className={`app__review-button ${isStreaming ? 'app__review-button--loading' : ''}`}
            onClick={handleReview}
            disabled={!result || isStreaming}
            title={!result ? 'Upload a PDF first' : 'Run design review'}
          >
            {isStreaming ? (
              <>
                <span className="app__spinner"></span>
                Reviewing...
              </>
            ) : (
              'Review'
            )}
          </button>
        </div>
      </header>

      <div className="app__content">
        <Sidebar
          filename={result.filename}
          documentType={documentType || result.documentType}
          confidence={result.confidence}
          metadata={result.extraction.metadata}
          onDocumentTypeChange={setDocumentType}
          onNewDocument={handleNewDocument}
        />
        <main className="app__main">
          <ReviewResults
            sections={sections}
            isStreaming={isStreaming}
            isComplete={isComplete}
            error={reviewError}
            onRetry={handleReview}
          />
          <DataTabs
            extraction={result.extraction}
            defaultCollapsed={true}
          />
        </main>
      </div>
    </div>
  );
}

export default App;
```

**Key changes summary:**
- Removed: useComplianceCheck, useAIAnalysis hooks
- Removed: Settings component and related state
- Removed: "Analyze with AI" button
- Added: useAIReview hook
- Added: ReviewResults component
- Renamed: "Check" -> "Review"
- Changed: DataTabs below ReviewResults with defaultCollapsed
  </action>
  <verify>
- File imports useAIReview and ReviewResults
- No imports of Settings, useComplianceCheck, or useAIAnalysis
- "Review" button present, "Check" and "Analyze with AI" absent
- ReviewResults component rendered with sections prop
  </verify>
  <done>
- App.tsx rewritten for AI review
- Settings removed
- Review button replaces Check + Analyze
- ReviewResults integrated
  </done>
</task>

<task type="auto">
  <name>Task 2: Update DataTabs for collapsed default</name>
  <files>frontend/src/components/DataTabs/DataTabs.tsx</files>
  <action>
Rewrite `frontend/src/components/DataTabs/DataTabs.tsx` to support collapsed default state and remove all check-result related functionality.

**Imports to REMOVE:**
```tsx
// DELETE these imports
import type { CheckResult } from '../../types/checks';
import type { DocumentAnalysisResult } from '../../types/ai';
import { CheckResults } from '../CheckResults';
```

**Imports to KEEP:**
```tsx
import { useState } from 'react';
import type { ExtractionResult } from '../../types/extraction';
import { TextTab } from './TextTab';
import { ImagesTab } from './ImagesTab';
import { MarginsTab } from './MarginsTab';
import { MetadataTab } from './MetadataTab';
import './DataTabs.css';
```

**New interface (replacing current):**
```tsx
interface DataTabsProps {
  extraction: ExtractionResult;
  defaultCollapsed?: boolean;
}
```

**Full component implementation:**
```tsx
type TabId = 'text' | 'images' | 'margins' | 'metadata';

export function DataTabs({ extraction, defaultCollapsed = false }: DataTabsProps) {
  const [isCollapsed, setIsCollapsed] = useState(defaultCollapsed);
  const [activeTab, setActiveTab] = useState<TabId>('text');

  const tabs: { id: TabId; label: string; count: number }[] = [
    { id: 'text', label: 'Text', count: extraction.fonts.length },
    { id: 'images', label: 'Images', count: extraction.images.length },
    { id: 'margins', label: 'Margins', count: extraction.margins.length },
    { id: 'metadata', label: 'Metadata', count: 1 },
  ];

  return (
    <div className="data-tabs">
      <button
        type="button"
        className="data-tabs__toggle"
        onClick={() => setIsCollapsed(!isCollapsed)}
        aria-expanded={!isCollapsed}
      >
        <span className="data-tabs__toggle-icon">
          {isCollapsed ? '\u25B6' : '\u25BC'}
        </span>
        Extracted Data
      </button>

      {!isCollapsed && (
        <>
          <div className="data-tabs__header">
            {tabs.map(tab => {
              const isEmpty = tab.id !== 'metadata' && tab.count === 0;
              return (
                <button
                  key={tab.id}
                  className={`data-tabs__tab ${activeTab === tab.id ? 'data-tabs__tab--active' : ''} ${isEmpty ? 'data-tabs__tab--disabled' : ''}`}
                  onClick={() => !isEmpty && setActiveTab(tab.id)}
                  disabled={isEmpty}
                >
                  {tab.label} ({tab.count})
                </button>
              );
            })}
          </div>
          <div className="data-tabs__content">
            {activeTab === 'text' && <TextTab fonts={extraction.fonts} textBlocks={extraction.text_blocks} />}
            {activeTab === 'images' && <ImagesTab images={extraction.images} />}
            {activeTab === 'margins' && <MarginsTab margins={extraction.margins} />}
            {activeTab === 'metadata' && <MetadataTab metadata={extraction.metadata} />}
          </div>
        </>
      )}
    </div>
  );
}
```

**What was removed:**
- CheckResult, DocumentAnalysisResult types
- CheckResults component import and rendering
- Props: checkResult, isChecking, onRecheck, aiResult, isAnalyzing, aiProgress, onReanalyze, documentType, pdfFile
- 'check-results' tab and all related logic
- Auto-switch to check-results useEffect
- getCheckResultsCount function

**What was added:**
- defaultCollapsed prop with useState
- Toggle button with expand/collapse icon
- Conditional rendering of tabs based on collapsed state
  </action>
  <verify>
- DataTabs accepts only extraction and defaultCollapsed props
- No CheckResults import or rendering
- No check-results tab in tabs array
- Toggle button renders with proper aria-expanded
- Tabs collapse/expand correctly
- Collapsed by default when defaultCollapsed={true}
  </verify>
  <done>
- DataTabs simplified to extraction data only
- All check result functionality removed
- Collapsible behavior with toggle button
- Default collapsed state supported
  </done>
</task>

<task type="auto">
  <name>Task 3: Update App.css for new layout</name>
  <files>frontend/src/App.css</files>
  <action>
Update `frontend/src/App.css` to:
1. Rename `.app__check-button` to `.app__review-button`
2. Remove `.app__ai-button` styles
3. Remove `.app__settings-button` styles (or keep minimal if still used elsewhere)
4. Add styles for new layout (ReviewResults above DataTabs)

Key changes:
- `.app__check-button` -> `.app__review-button`
- Remove AI button specific styles
- Adjust main content layout for stacked components
  </action>
  <verify>
- .app__review-button styles exist
- No .app__check-button references
- Layout supports ReviewResults + DataTabs stacked
  </verify>
  <done>
- CSS updated for new button naming
- Layout supports new component structure
  </done>
</task>

</tasks>

<verification>
1. App.tsx imports useAIReview and ReviewResults
2. No Settings, Check, or "Analyze with AI" buttons in rendered output
3. DataTabs collapses by default
4. TypeScript compiles: `cd frontend && npx tsc --noEmit`
5. App renders without errors
</verification>

<success_criteria>
- App uses new AI review system
- Settings removed from header
- Single "Review" button triggers AI review
- DataTabs collapsed by default
- ReviewResults displays above DataTabs
</success_criteria>

<output>
After completion, create `.planning/phases/07-ai-first-architecture/07-07-SUMMARY.md`
</output>
