---
phase: 07-ai-first-architecture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/app/main.py
  - backend/app/config/rules_context/working_paper.md
  - backend/app/config/rules_context/publication.md
  - backend/app/config/rules_context/brief.md
  - backend/app/config/rules_context/factsheet.md
  - backend/app/services/pdf_extractor.py
  - backend/app/services/margin_calculator.py
  - backend/app/services/document_type_detector.py
autonomous: true

must_haves:
  truths:
    - "Backend starts without /api/check endpoints"
    - "Only /api/extraction and /api/ai routes available"
    - "No programmatic compliance logic in response payloads"
    - "Rules context files exist for each document type"
    - "Extraction responses contain only measurements, no pass/fail judgments"
  artifacts:
    - path: "backend/app/main.py"
      provides: "FastAPI app without checks router"
      contains: "# check_router removed"
    - path: "backend/app/config/rules_context/working_paper.md"
      provides: "Working paper design rules"
      min_lines: 30
    - path: "backend/app/config/rules_context/publication.md"
      provides: "Publication design rules"
      min_lines: 30
    - path: "backend/app/config/rules_context/brief.md"
      provides: "Brief design rules"
      min_lines: 30
    - path: "backend/app/config/rules_context/factsheet.md"
      provides: "Factsheet design rules"
      min_lines: 30
  key_links:
    - from: "backend/app/main.py"
      to: "checks module"
      via: "router import removed"
      pattern: "# check_router removed"
---

<objective>
Delete the entire checks module, audit extraction services for compliance-free output, and create rules context markdown files for AI consumption.

Purpose: Remove programmatic compliance logic (ARCH-02), ensure extractor outputs measurements only (ARCH-01), and establish human-readable rules context (ARCH-05) that AI will use for all compliance decisions.

Output: Clean backend without checks module, verified measurement-only extraction, 4 rules context markdown files with prose + measurements.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-ai-first-architecture/07-CONTEXT.md
@.planning/phases/07-ai-first-architecture/07-RESEARCH.md
@backend/app/main.py
@backend/app/config/templates/factsheet.yaml
@backend/app/config/templates/publication.yaml
@backend/app/config/templates/brief.yaml
@backend/app/services/pdf_extractor.py
@backend/app/services/margin_calculator.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete checks module and update main.py</name>
  <files>
    backend/app/main.py
    backend/app/checks/ (entire directory)
  </files>
  <action>
1. Delete the entire `backend/app/checks/` directory (including all handlers, models, executor, router, tolerance.py, __pycache__)

2. Update `backend/app/main.py`:
   - Remove the import: `from app.checks.router import router as check_router`
   - Remove the router registration: `app.include_router(check_router)`
   - Add a comment where the import was: `# check_router removed - AI handles all compliance decisions (Phase 7)`

The checks module is being replaced by AI-driven compliance decisions. All programmatic check handlers (range, regex, font, position, presence, color) are no longer needed.
  </action>
  <verify>
- `backend/app/checks/` directory does not exist
- `python -c "from app.main import app; print('OK')"` runs without import errors (from backend directory)
- main.py does not contain "check_router"
  </verify>
  <done>
- Checks module completely deleted
- main.py updated without checks router
- FastAPI app still initializes successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit extraction services for compliance-free output (ARCH-01)</name>
  <files>
    backend/app/services/pdf_extractor.py
    backend/app/services/margin_calculator.py
    backend/app/services/document_type_detector.py
    backend/app/services/text_processor.py
    backend/app/services/image_processor.py
  </files>
  <action>
Audit and verify that all extraction services output ONLY measurements with ZERO compliance judgments.

**Audit checklist for each service file:**

1. **pdf_extractor.py**: Should extract raw data (fonts, images, text blocks, margins) without any:
   - "valid/invalid" flags
   - "pass/fail" indicators
   - "error/warning" classifications
   - "compliant/non-compliant" labels

2. **margin_calculator.py**: Should output margin measurements in points/mm without:
   - Comparison to minimum/maximum thresholds
   - "too small/too large" determinations
   - Any reference to rule requirements

3. **document_type_detector.py**: Should detect document type and return confidence score without:
   - Validation against expected formats
   - "correct/incorrect" document type flags

4. **text_processor.py**: Should extract font info and text blocks without:
   - Font size validation
   - "allowed/disallowed" font classifications

5. **image_processor.py**: Should extract image dimensions and DPI without:
   - DPI threshold comparisons
   - "low resolution" flags

**If any compliance logic found:**
- Remove the judgment logic
- Keep only the raw measurement extraction
- Ensure return types are pure data (numbers, strings, arrays)

**Expected outcome:** All services return factual measurements. No service makes any determination about whether measurements meet requirements - that's now exclusively the AI's job.
  </action>
  <verify>
- grep -r "valid\|invalid\|pass\|fail\|error\|warning\|compliant\|violation" backend/app/services/ returns no compliance judgment patterns (comments explaining measurements are OK)
- ExtractionResult model contains only data fields, no status/judgment fields
- Document type detection returns type + confidence, no validation flags
  </verify>
  <done>
- All extraction services verified to output measurements only
- No compliance judgments in extraction pipeline
- ARCH-01 requirement satisfied
  </done>
</task>

<task type="auto">
  <name>Task 3: Create rules context markdown files</name>
  <files>
    backend/app/config/rules_context/working_paper.md
    backend/app/config/rules_context/publication.md
    backend/app/config/rules_context/brief.md
    backend/app/config/rules_context/factsheet.md
  </files>
  <action>
Create directory `backend/app/config/rules_context/` and 4 markdown files.

Reference the YAML templates to extract measurement values, then express as prose + measurements.

Each file follows this structure (adapt for document type):

```markdown
# [Document Type] Design Requirements

## Cover Page
- UNEP logo: top-right corner, minimum 20mm width, target 27.5mm
- Title: clear hierarchy, readable at a glance
- UN Blue (#0099CC) used for accents is preferred

## Typography
- Body text: 10-12pt, preferably Roboto or similar sans-serif
- Minimum text size: 7pt for footnotes
- Consistent font usage throughout (avoid mixing more than 3 font families)

## Images
- Photos: minimum 150 DPI at print size, 300 DPI preferred
- Logos and diagrams: vector or 300+ DPI
- All images should have adequate contrast and be clearly visible

## Margins
- Minimum margins: [specific values per doc type]
- Inside margins (binding edge): [value]
- Full-bleed images are acceptable and intentional

## Required Elements
- ISBN on back cover or copyright page (for Publications)
- DOI if assigned
- Copyright notice
- Publication date
- UNEP contact information
```

**Document-specific notes:**
- **Factsheet**: Single page or spread, compact margins (15mm typical), no ISBN required
- **Brief/Issue Note**: Similar to working paper, 20mm margins, DOI/job number required
- **Working Paper**: Standard academic format, 20-25mm margins, all metadata required
- **Publication**: Full publication with ISBN, back cover elements, SDG icons required

Pull specific values from the YAML templates (e.g., margin ranges, font sizes, DPI requirements).
  </action>
  <verify>
- All 4 files exist in `backend/app/config/rules_context/`
- Each file is >30 lines with substantive content
- Each file covers: Cover, Typography, Images, Margins, Required Elements sections
  </verify>
  <done>
- 4 rules context markdown files created
- Each file has prose explanations with specific measurements
- Rules are human-readable for AI consumption
  </done>
</task>

</tasks>

<verification>
1. `ls backend/app/checks/` fails (directory deleted)
2. `python -c "from app.main import app"` succeeds
3. All 4 rules context files exist with >30 lines each
4. No references to "check_router" in main.py
5. Extraction services contain no compliance judgment logic
</verification>

<success_criteria>
- Checks module completely removed from codebase
- Extraction services output measurements only (ARCH-01 verified)
- main.py imports/initializes without errors
- 4 rules context markdown files ready for AI consumption
- Backend still starts: `python -m uvicorn app.main:app --port 8003`
</success_criteria>

<output>
After completion, create `.planning/phases/07-ai-first-architecture/07-01-SUMMARY.md`
</output>
