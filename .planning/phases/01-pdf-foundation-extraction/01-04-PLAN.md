---
phase: 01-pdf-foundation-extraction
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - frontend/src/hooks/useExtraction.ts
  - frontend/src/components/DataTabs/DataTabs.tsx
  - frontend/src/components/DataTabs/DataTabs.css
  - frontend/src/components/DataTabs/TextTab.tsx
  - frontend/src/components/DataTabs/ImagesTab.tsx
  - frontend/src/components/DataTabs/MarginsTab.tsx
  - frontend/src/components/DataTabs/MetadataTab.tsx
  - frontend/src/components/DataTabs/index.ts
  - frontend/src/components/Sidebar/Sidebar.tsx
  - frontend/src/components/Sidebar/Sidebar.css
  - frontend/src/components/Sidebar/index.ts
  - frontend/src/App.tsx
  - frontend/src/App.css
autonomous: true

must_haves:
  truths:
    - "User can drop a PDF and see extraction results in tabbed interface"
    - "Text tab shows font summary table with counts"
    - "Images tab shows sortable list with DPI column"
    - "Margins tab shows per-page table with all margin values"
    - "Metadata tab shows key document fields"
    - "Sidebar shows filename, page count, and document type with override dropdown"
    - "Empty tabs are disabled with count indicator"
  artifacts:
    - path: "frontend/src/hooks/useExtraction.ts"
      provides: "API integration hook"
      exports: ["useExtraction"]
    - path: "frontend/src/components/DataTabs/DataTabs.tsx"
      provides: "Tabbed content display"
      exports: ["DataTabs"]
    - path: "frontend/src/components/Sidebar/Sidebar.tsx"
      provides: "Document info sidebar"
      exports: ["Sidebar"]
    - path: "frontend/src/App.tsx"
      provides: "Main application with full workflow"
  key_links:
    - from: "frontend/src/hooks/useExtraction.ts"
      to: "/api/upload"
      via: "fetch call"
      pattern: "fetch.*api/upload"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/components/DropZone/DropZone.tsx"
      via: "component import"
      pattern: "import.*DropZone"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/components/DataTabs/DataTabs.tsx"
      via: "component import"
      pattern: "import.*DataTabs"
---

<objective>
Wire the frontend to the backend API and create the complete data display interface with tabbed panels and document info sidebar.

Purpose: Complete the Phase 1 user experience - upload a PDF and see all extracted content in an organized, sortable interface.

Output: Fully functional upload-to-display workflow with all four data tabs and document info sidebar.
</objective>

<execution_context>
@C:\Users\abelb\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abelb\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/LEARNINGS.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-pdf-foundation-extraction/01-CONTEXT.md
@.planning/phases/01-pdf-foundation-extraction/01-RESEARCH.md
@.planning/phases/01-pdf-foundation-extraction/01-02-SUMMARY.md
@.planning/phases/01-pdf-foundation-extraction/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API hook and data tabs</name>
  <files>
    frontend/src/hooks/useExtraction.ts
    frontend/src/components/DataTabs/DataTabs.tsx
    frontend/src/components/DataTabs/DataTabs.css
    frontend/src/components/DataTabs/TextTab.tsx
    frontend/src/components/DataTabs/ImagesTab.tsx
    frontend/src/components/DataTabs/MarginsTab.tsx
    frontend/src/components/DataTabs/MetadataTab.tsx
    frontend/src/components/DataTabs/index.ts
  </files>
  <action>
**Create useExtraction hook** in `frontend/src/hooks/useExtraction.ts`:

```tsx
import { useState, useCallback } from 'react';
import type { ExtractionResult, DocumentType, Confidence } from '../types/extraction';

interface UploadState {
  isUploading: boolean;
  error: string | null;
  result: {
    filename: string;
    documentType: DocumentType;
    confidence: Confidence;
    extraction: ExtractionResult;
  } | null;
}

export function useExtraction() {
  const [state, setState] = useState<UploadState>({
    isUploading: false,
    error: null,
    result: null,
  });

  const upload = useCallback(async (file: File) => {
    setState({ isUploading: true, error: null, result: null });

    try {
      const formData = new FormData();
      formData.append('file', file);

      const response = await fetch('http://localhost:8000/api/upload', {
        method: 'POST',
        body: formData,
      });

      const data = await response.json();

      if (!response.ok) {
        // Handle rejection (rasterized PDF)
        if (data.error === 'rasterized_pdf') {
          setState({
            isUploading: false,
            error: `${data.message} ${data.details}`,
            result: null,
          });
          return;
        }
        throw new Error(data.detail || 'Upload failed');
      }

      setState({
        isUploading: false,
        error: null,
        result: {
          filename: data.filename,
          documentType: data.document_type,
          confidence: data.confidence,
          extraction: data.extraction,
        },
      });
    } catch (err) {
      setState({
        isUploading: false,
        error: err instanceof Error ? err.message : 'Upload failed',
        result: null,
      });
    }
  }, []);

  const reset = useCallback(() => {
    setState({ isUploading: false, error: null, result: null });
  }, []);

  return { ...state, upload, reset };
}
```

**Create DataTabs component** in `frontend/src/components/DataTabs/DataTabs.tsx`:

```tsx
import { useState } from 'react';
import type { ExtractionResult } from '../../types/extraction';
import { TextTab } from './TextTab';
import { ImagesTab } from './ImagesTab';
import { MarginsTab } from './MarginsTab';
import { MetadataTab } from './MetadataTab';
import './DataTabs.css';

interface DataTabsProps {
  extraction: ExtractionResult;
}

type TabId = 'text' | 'images' | 'margins' | 'metadata';

export function DataTabs({ extraction }: DataTabsProps) {
  const [activeTab, setActiveTab] = useState<TabId>('text');

  const tabs: { id: TabId; label: string; count: number }[] = [
    { id: 'text', label: 'Text', count: extraction.fonts.length },
    { id: 'images', label: 'Images', count: extraction.images.length },
    { id: 'margins', label: 'Margins', count: extraction.margins.length },
    { id: 'metadata', label: 'Metadata', count: 1 },
  ];

  return (
    <div className="data-tabs">
      <div className="data-tabs__header">
        {tabs.map(tab => {
          const isEmpty = tab.id !== 'metadata' && tab.count === 0;
          return (
            <button
              key={tab.id}
              className={`data-tabs__tab ${activeTab === tab.id ? 'data-tabs__tab--active' : ''} ${isEmpty ? 'data-tabs__tab--disabled' : ''}`}
              onClick={() => !isEmpty && setActiveTab(tab.id)}
              disabled={isEmpty}
            >
              {tab.label} ({tab.count})
            </button>
          );
        })}
      </div>
      <div className="data-tabs__content">
        {activeTab === 'text' && <TextTab fonts={extraction.fonts} textBlocks={extraction.text_blocks} />}
        {activeTab === 'images' && <ImagesTab images={extraction.images} />}
        {activeTab === 'margins' && <MarginsTab margins={extraction.margins} />}
        {activeTab === 'metadata' && <MetadataTab metadata={extraction.metadata} />}
      </div>
    </div>
  );
}
```

**Create TextTab** (CONTEXT.md: "Summary table of all fonts found with counts/locations"):

```tsx
import { useMemo } from 'react';
import { createColumnHelper } from '@tanstack/react-table';
import { SortableTable } from '../SortableTable';
import type { FontSummary, TextBlock } from '../../types/extraction';

interface TextTabProps {
  fonts: FontSummary[];
  textBlocks: TextBlock[];
}

const columnHelper = createColumnHelper<FontSummary>();

const columns = [
  columnHelper.accessor('name', { header: 'Font Name' }),
  columnHelper.accessor('count', { header: 'Occurrences' }),
  columnHelper.accessor('pages', {
    header: 'Pages',
    cell: info => info.getValue().join(', '),
  }),
];

export function TextTab({ fonts, textBlocks }: TextTabProps) {
  return (
    <div className="text-tab">
      <h3>Font Summary</h3>
      <SortableTable
        data={fonts}
        columns={columns}
        defaultSort={[{ id: 'count', desc: true }]}
        emptyMessage="No fonts found"
      />
      <p className="text-tab__count">{textBlocks.length} text blocks extracted</p>
    </div>
  );
}
```

**Create ImagesTab** (CONTEXT.md: "sortable by DPI to spot low-res images instantly"):

```tsx
import { createColumnHelper } from '@tanstack/react-table';
import { SortableTable } from '../SortableTable';
import type { ImageInfo } from '../../types/extraction';

interface ImagesTabProps {
  images: ImageInfo[];
}

const columnHelper = createColumnHelper<ImageInfo>();

const columns = [
  columnHelper.accessor('page', { header: 'Page' }),
  columnHelper.accessor(row => `${row.width} x ${row.height}`, {
    id: 'dimensions',
    header: 'Dimensions'
  }),
  columnHelper.accessor('dpi_x', {
    header: 'DPI (X)',
    cell: info => info.getValue().toFixed(0),
  }),
  columnHelper.accessor('dpi_y', {
    header: 'DPI (Y)',
    cell: info => info.getValue().toFixed(0),
  }),
  columnHelper.accessor('colorspace', { header: 'Color Space' }),
  columnHelper.accessor('has_mask', {
    header: 'Has Mask',
    cell: info => info.getValue() ? 'Yes' : 'No',
  }),
];

export function ImagesTab({ images }: ImagesTabProps) {
  return (
    <div className="images-tab">
      <SortableTable
        data={images}
        columns={columns}
        defaultSort={[{ id: 'dpi_x', desc: false }]}  // Sort by DPI ascending to show low-res first
        emptyMessage="No images found"
      />
    </div>
  );
}
```

**Create MarginsTab** (CONTEXT.md: "Table per page showing Page | Top | Bottom | Inside | Outside"):

```tsx
import { createColumnHelper } from '@tanstack/react-table';
import { SortableTable } from '../SortableTable';
import type { PageMargins } from '../../types/extraction';

interface MarginsTabProps {
  margins: PageMargins[];
}

const columnHelper = createColumnHelper<PageMargins>();

// Convert points to mm for display (72 points = 25.4 mm)
const ptToMm = (pt: number) => (pt / 72 * 25.4).toFixed(1);

const columns = [
  columnHelper.accessor('page', { header: 'Page' }),
  columnHelper.accessor('top', {
    header: 'Top (mm)',
    cell: info => ptToMm(info.getValue()),
  }),
  columnHelper.accessor('bottom', {
    header: 'Bottom (mm)',
    cell: info => ptToMm(info.getValue()),
  }),
  columnHelper.accessor('inside', {
    header: 'Inside (mm)',
    cell: info => ptToMm(info.getValue()),
  }),
  columnHelper.accessor('outside', {
    header: 'Outside (mm)',
    cell: info => ptToMm(info.getValue()),
  }),
];

export function MarginsTab({ margins }: MarginsTabProps) {
  return (
    <div className="margins-tab">
      <SortableTable
        data={margins}
        columns={columns}
        defaultSort={[{ id: 'page', desc: false }]}
        emptyMessage="No margin data available"
      />
    </div>
  );
}
```

**Create MetadataTab** (CONTEXT.md: "Key fields only with 'Show all metadata' expandable"):

```tsx
import { useState } from 'react';
import type { DocumentMetadata } from '../../types/extraction';

interface MetadataTabProps {
  metadata: DocumentMetadata;
}

export function MetadataTab({ metadata }: MetadataTabProps) {
  const [showAll, setShowAll] = useState(false);

  const keyFields = [
    { label: 'Title', value: metadata.title },
    { label: 'Author', value: metadata.author },
    { label: 'ISBN', value: metadata.isbn },
    { label: 'DOI', value: metadata.doi },
    { label: 'Job Number', value: metadata.job_number },
    { label: 'Creation Date', value: metadata.creation_date },
    { label: 'Producer', value: metadata.producer },
  ];

  return (
    <div className="metadata-tab">
      <table className="metadata-table">
        <tbody>
          {keyFields.map(field => (
            <tr key={field.label}>
              <th>{field.label}</th>
              <td>{field.value || <span className="metadata-empty">Not found</span>}</td>
            </tr>
          ))}
        </tbody>
      </table>
      <button
        className="metadata-toggle"
        onClick={() => setShowAll(!showAll)}
      >
        {showAll ? 'Hide details' : 'Show all metadata'}
      </button>
      {showAll && (
        <pre className="metadata-raw">
          {JSON.stringify(metadata, null, 2)}
        </pre>
      )}
    </div>
  );
}
```

**DataTabs.css** and **index.ts** - standard styling for tabs and exports.
  </action>
  <verify>
- `cd frontend && npm run build` succeeds
- All tab components render without errors
- Tables use SortableTable component correctly
  </verify>
  <done>
- useExtraction hook handles upload and state management
- DataTabs component with four tabs implemented
- Each tab shows appropriate data with sorting
- Empty tabs show disabled state with count
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Sidebar and wire up App</name>
  <files>
    frontend/src/components/Sidebar/Sidebar.tsx
    frontend/src/components/Sidebar/Sidebar.css
    frontend/src/components/Sidebar/index.ts
    frontend/src/App.tsx
    frontend/src/App.css
  </files>
  <action>
**Create Sidebar component** (CONTEXT.md: "Document type shown in sidebar field alongside filename, page count"):

```tsx
import { useState } from 'react';
import type { DocumentMetadata, DocumentType, Confidence } from '../../types/extraction';
import './Sidebar.css';

interface SidebarProps {
  filename: string;
  documentType: DocumentType;
  confidence: Confidence;
  metadata: DocumentMetadata;
  onDocumentTypeChange: (type: DocumentType) => void;
  onNewDocument: () => void;
}

const DOCUMENT_TYPES: DocumentType[] = [
  'Factsheet',
  'Policy Brief',
  'Working Paper',
  'Technical Report',
  'Publication',
];

export function Sidebar({
  filename,
  documentType,
  confidence,
  metadata,
  onDocumentTypeChange,
  onNewDocument,
}: SidebarProps) {
  return (
    <aside className="sidebar">
      <div className="sidebar__header">
        <h2>Document Info</h2>
        <button className="sidebar__new-btn" onClick={onNewDocument}>
          New Document
        </button>
      </div>

      <div className="sidebar__section">
        <label className="sidebar__label">Filename</label>
        <p className="sidebar__value">{filename}</p>
      </div>

      <div className="sidebar__section">
        <label className="sidebar__label">Pages</label>
        <p className="sidebar__value">{metadata.page_count}</p>
      </div>

      <div className="sidebar__section">
        <label className="sidebar__label">Document Type</label>
        <select
          className="sidebar__select"
          value={documentType}
          onChange={e => onDocumentTypeChange(e.target.value as DocumentType)}
        >
          {DOCUMENT_TYPES.map(type => (
            <option key={type} value={type}>{type}</option>
          ))}
        </select>
        <span className={`sidebar__confidence sidebar__confidence--${confidence}`}>
          {confidence} confidence
        </span>
      </div>

      {metadata.title && (
        <div className="sidebar__section">
          <label className="sidebar__label">Title</label>
          <p className="sidebar__value sidebar__value--title">{metadata.title}</p>
        </div>
      )}
    </aside>
  );
}
```

**Sidebar.css:**
```css
.sidebar {
  width: 280px;
  background: #f8f9fa;
  border-right: 1px solid #e0e0e0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.sidebar__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.sidebar__header h2 {
  margin: 0;
  font-size: 18px;
  color: #333;
}

.sidebar__new-btn {
  padding: 6px 12px;
  background: #1976d2;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
}

.sidebar__new-btn:hover {
  background: #1565c0;
}

.sidebar__section {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.sidebar__label {
  font-size: 12px;
  font-weight: 600;
  color: #666;
  text-transform: uppercase;
}

.sidebar__value {
  margin: 0;
  font-size: 14px;
  color: #333;
}

.sidebar__value--title {
  font-style: italic;
}

.sidebar__select {
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
}

.sidebar__confidence {
  font-size: 12px;
  margin-top: 4px;
}

.sidebar__confidence--high {
  color: #2e7d32;
}

.sidebar__confidence--medium {
  color: #f57c00;
}

.sidebar__confidence--low {
  color: #c62828;
}
```

**Update App.tsx** to wire everything together:

```tsx
import { useState } from 'react';
import { DropZone } from './components/DropZone';
import { DataTabs } from './components/DataTabs';
import { Sidebar } from './components/Sidebar';
import { useExtraction } from './hooks/useExtraction';
import type { DocumentType } from './types/extraction';
import './App.css';

function App() {
  const { isUploading, error, result, upload, reset } = useExtraction();
  const [documentType, setDocumentType] = useState<DocumentType | null>(null);

  // Sync document type from result when it changes
  if (result && documentType === null) {
    setDocumentType(result.documentType);
  }

  const handleNewDocument = () => {
    reset();
    setDocumentType(null);
  };

  // Show upload view if no result
  if (!result) {
    return (
      <div className="app app--upload">
        <header className="app__header">
          <h1>PubCheck</h1>
          <p>UNEP PDF Design Compliance Checker</p>
        </header>
        <main className="app__upload-area">
          <DropZone
            onFileAccepted={upload}
            isProcessing={isUploading}
            error={error}
          />
        </main>
      </div>
    );
  }

  // Show results view
  return (
    <div className="app app--results">
      <header className="app__header app__header--compact">
        <h1>PubCheck</h1>
      </header>
      <div className="app__content">
        <Sidebar
          filename={result.filename}
          documentType={documentType || result.documentType}
          confidence={result.confidence}
          metadata={result.extraction.metadata}
          onDocumentTypeChange={setDocumentType}
          onNewDocument={handleNewDocument}
        />
        <main className="app__main">
          <DataTabs extraction={result.extraction} />
        </main>
      </div>
    </div>
  );
}

export default App;
```

**App.css:**
```css
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.app {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.app__header {
  background: #1976d2;
  color: white;
  padding: 20px 40px;
}

.app__header h1 {
  margin: 0 0 8px 0;
  font-size: 28px;
}

.app__header p {
  margin: 0;
  opacity: 0.9;
}

.app__header--compact {
  padding: 12px 20px;
}

.app__header--compact h1 {
  font-size: 20px;
  margin: 0;
}

/* Upload view */
.app--upload {
  background: #f5f5f5;
}

.app__upload-area {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px;
}

.app__upload-area .drop-zone {
  max-width: 600px;
  width: 100%;
}

/* Results view */
.app--results .app__content {
  flex: 1;
  display: flex;
}

.app__main {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}
```
  </action>
  <verify>
- `cd frontend && npm run dev` starts without errors
- Open browser to localhost:5173
- Drop a PDF file
- Verify:
  - Spinner shows during upload
  - Results display with sidebar and tabs
  - Document type can be changed via dropdown
  - "New Document" returns to upload view
  </verify>
  <done>
- Complete workflow from upload to display works
- Sidebar shows filename, page count, document type with override
- All four tabs display extracted data
- Sorting works on all tables
- "New Document" button returns to upload view
  </done>
</task>

</tasks>

<verification>
1. Full workflow test:
   - Start backend: `cd backend && python -m uvicorn app.main:app --reload`
   - Start frontend: `cd frontend && npm run dev`
   - Open http://localhost:5173
   - Drop a PDF file
   - Verify extraction results appear in tabs

2. Verify all CONTEXT.md decisions:
   - Drop zone has dashed border, highlights on drag
   - Tabs show counts, disabled when empty
   - Images sortable by DPI
   - Margins show in mm
   - Metadata has "Show all" toggle
   - Document type has dropdown override
   - Confidence shown next to document type

3. Error handling:
   - Drop non-PDF file - error shown
   - Upload rasterized PDF - rejection message shown
</verification>

<success_criteria>
- User can upload PDF and see extraction results
- All four tabs work with sortable data
- Sidebar shows document info with type override
- Error states handled gracefully
- No console errors in browser
</success_criteria>

<output>
After completion, create `.planning/phases/01-pdf-foundation-extraction/01-04-SUMMARY.md`
</output>
